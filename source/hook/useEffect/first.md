---
title: useEffectæŒ‡å—(1)
date: 2020-10-26 10:18:53
tag: Hook
layout: post
toc: true
---

## åˆ†æ

### æ¯ä¸ªæ¸²æŸ“éƒ½æœ‰è‡ªå·±çš„propså’ŒçŠ¶æ€

åœ¨æˆ‘ä»¬è°ˆè®ºæ•ˆæœä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦è®¨è®ºæ¸²æŸ“, è¿™æ˜¯ä¸€ä¸ªcounterã€‚ä»”ç»†æŸ¥çœ‹çªå‡ºæ˜¾ç¤ºçš„è¡Œï¼š

``` js
function Counter() {
    const [count, setCount] = useState(0);
    return (
        <div>

    -     <p>You clicked {count} times</p>

        <button onClick={() => setCount(count + 1)}>
            Click me
        </button>
        </div>
    );
}
```

è¿™æ˜¯ä»€ä¹ˆæ„æ€? æ˜¯å¦countä»¥æŸç§æ–¹å¼â€œç›‘è§†â€çŠ¶æ€çš„æ›´æ”¹å¹¶è‡ªåŠ¨æ›´æ–°? å½“ä½ å­¦ä¹ Reactæ—¶ï¼Œè¿™å¯èƒ½æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„ç¬¬ä¸€ç›´è§‰ï¼Œä½†å®ƒä¸æ˜¯ä¸€ä¸ªå‡†ç¡®çš„å¿ƒç†æ¨¡å‹ã€‚
åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œcountåªæ˜¯ä¸€ä¸ªæ•°å­—ã€‚ å®ƒä¸æ˜¯ç¥å¥‡çš„â€œæ•°æ®ç»‘å®šâ€ï¼Œâ€œè§‚å¯Ÿè€…â€ï¼Œâ€œä»£ç†â€æˆ–å…¶ä»–ä»»ä½•ä¸œè¥¿ã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆå¤è€çš„æ•°å­—:

``` javascript
const count = 42; 

// ...

<p>You clicked {count} times</p>

// ...
```

æˆ‘ä»¬çš„ç»„ä»¶ç¬¬ä¸€æ¬¡æ¸²æŸ“æ—¶ï¼Œæˆ‘ä»¬ä»useState()å¾—åˆ°çš„countå˜é‡æ˜¯0ã€‚å½“æˆ‘ä»¬è°ƒç”¨setCount(1)æ—¶ï¼ŒReactå†æ¬¡è°ƒç”¨æˆ‘ä»¬çš„ç»„ä»¶ã€‚è¿™ä¸€æ¬¡ï¼Œcountå°†æ˜¯1ã€‚ä¾æ­¤ç±»æ¨ï¼š

``` javascript
// During first render
function Counter() {

    const count = 0; // Returned by useState()
    // ...
    <p>You clicked {count} times</p>
    // ...

}

// After a click, our function is called again
function Counter() {

    const count = 1; // Returned by useState()
    // ...
    <p>You clicked {count} times</p>
    // ...

}

// After another click, our function is called again
function Counter() {

    const count = 2; // Returned by useState()
    // ...
    <p>You clicked {count} times</p>
    // ...

}
```

æ¯å½“æˆ‘ä»¬æ›´æ–°çŠ¶æ€æ—¶ï¼ŒReactéƒ½ä¼šè°ƒç”¨æˆ‘ä»¬çš„ç»„ä»¶ã€‚æ¯ä¸ªæ¸²æŸ“ç»“æœâ€œçœ‹åˆ°â€å®ƒè‡ªå·±çš„counterçŠ¶æ€å€¼ï¼Œè¿™æ˜¯æˆ‘ä»¬å‡½æ•°å†…çš„å¸¸é‡ã€‚
æ‰€ä»¥è¿™ä¸€è¡Œæ²¡æœ‰åšä»»ä½•ç‰¹æ®Šçš„æ•°æ®ç»‘å®šï¼š

 `<p>You clicked {count} times</p>`
å®ƒåªæ˜¯åœ¨æ¸²æŸ“è¾“å‡ºä¸­åµŒå…¥ä¸€ä¸ªæ•°å€¼ã€‚ è¯¥æ•°å­—ç”±Reactæä¾›ã€‚å½“æˆ‘ä»¬setCountæ—¶ï¼ŒReactå†æ¬¡ä½¿ç”¨ä¸åŒçš„countå€¼è°ƒç”¨æˆ‘ä»¬çš„ç»„ä»¶ã€‚ç„¶åReactæ›´æ–°DOMä»¥åŒ¹é…æˆ‘ä»¬æœ€æ–°çš„æ¸²æŸ“è¾“å‡ºã€‚
å…³é”®æ˜¯ï¼Œä»»ä½•ç‰¹å®šæ¸²æŸ“ä¸­çš„countå¸¸é‡éƒ½ä¸ä¼šéšæ—¶é—´å˜åŒ–ã€‚å†æ¬¡è°ƒç”¨çš„æ˜¯æˆ‘ä»¬çš„ç»„ä»¶â€”â€”æ¯ä¸ªæ¸²æŸ“éƒ½â€œçœ‹åˆ°â€è‡ªå·±çš„countå€¼ï¼Œè¯¥å€¼åœ¨æ¸²æŸ“ä¹‹é—´æ˜¯ç‹¬ç«‹çš„ã€‚

### æ¯ä¸ªæ¸²æŸ“éƒ½æœ‰è‡ªå·±çš„äº‹ä»¶å¤„ç†ç¨‹åº

åˆ°ç°åœ¨ä¸ºæ­¢è¿˜æŒºå¥½ã€‚é‚£ä¹ˆå…³äºäº‹ä»¶å¤„ç†ç¨‹åºæ˜¯æ€æ ·çš„ï¼Ÿ
çœ‹çœ‹è¿™ä¸ªä¾‹å­ã€‚å®ƒä¼šåœ¨ä¸‰ç§’é’Ÿåæ˜¾ç¤ºcountçš„å¼¹æ¡†ï¼š

``` javascript
function Counter() {
    const [count, setCount] = useState(0); 
    function handleAlertClick() {
        setTimeout(() => {
        alert('You clicked on: ' + count);
        }, 3000);
    }

    return (
        <div>
        <p>You clicked {count} times</p>
        <button onClick={() => setCount(count + 1)}>
            Click me
        </button>
        <button onClick={handleAlertClick}>
            Show alert
        </button>
        </div>
    ); 

}
```

å‡è®¾æˆ‘æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š

    å¢åŠ  è®¡æ•°åˆ°3
    ç‚¹å‡» â€œShow alertâ€
    å¢åŠ  åˆ°5ï¼Œåœ¨timeoutè§¦å‘ä¹‹å‰

ä½ å¸Œæœ›å¼¹å‡ºæ¡†æ˜¾ç¤ºä»€ä¹ˆï¼Ÿå®ƒä¼šæ˜¾ç¤º `5` - è¿™æ˜¯å¼¹æ¡†æ—¶çš„è®¡æ•°å™¨çŠ¶æ€å—ï¼Ÿæˆ–è€…å®ƒä¼šæ˜¾ç¤º `3` - æˆ‘ç‚¹å‡»æ—¶çš„çŠ¶æ€ï¼Ÿ
å¦‚æœè¿™ç§è¡Œä¸ºå¯¹ä½ æ²¡æœ‰æ„ä¹‰ï¼Œæƒ³è±¡ä¸€ä¸ªæ›´å®é™…çš„ä¾‹å­ï¼šä¸€ä¸ªèŠå¤©åº”ç”¨ç¨‹åºï¼Œå½“å‰æ”¶ä»¶äºº `ID` åœ¨çŠ¶æ€ä¸­ï¼Œå¹¶æœ‰ä¸€ä¸ªå‘é€æŒ‰é’®ã€‚è¿™ç¯‡æ–‡ç« æ·±å…¥æ¢è®¨äº†åŸå› ï¼Œä½†æ­£ç¡®çš„ç­”æ¡ˆæ˜¯ `3` ã€‚
å¼¹æ¡† `(alert)` å°†åœ¨æˆ‘å•å‡»æŒ‰é’®æ—¶**æ•è·**çŠ¶æ€ã€‚
(æœ‰ä¸€äº›æ–¹æ³•å¯ä»¥å®ç°å…¶ä»–è¡Œä¸ºï¼Œä½†æˆ‘ç°åœ¨å°†å…³æ³¨é»˜è®¤æƒ…å†µã€‚å½“æˆ‘ä»¬å»ºç«‹ä¸€ä¸ªå¿ƒç†æ¨¡å‹æ—¶ï¼Œé‡è¦çš„æ˜¯æˆ‘ä»¬è¦åŒºåˆ†â€œæœ€å°é˜»åŠ›è·¯å¾„â€å’Œé€‰æ‹©è¿›å…¥é€ƒç”Ÿèˆ±ã€‚)
ä½†å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ
æˆ‘ä»¬å·²ç»è®¨è®ºè¿‡ `count` å€¼å¯¹äºæˆ‘ä»¬å‡½æ•°çš„æ¯ä¸ªç‰¹å®šè°ƒç”¨éƒ½æ˜¯å¸¸é‡ã€‚å€¼å¾—å¼ºè°ƒçš„æ˜¯è¿™ä¸€ç‚¹ â€” æˆ‘ä»¬çš„å‡½æ•°è¢«è°ƒç”¨äº†å¾ˆå¤šæ¬¡(æ¯æ¬¡æ¸²æŸ“ä¸€æ¬¡)ï¼Œä½†æ˜¯æ¯æ¬¡è°ƒç”¨çš„ `count` å€¼éƒ½æ˜¯å¸¸é‡ï¼Œå¹¶è¢«è®¾ç½®ä¸ºä¸€ä¸ªç‰¹å®šçš„å€¼(è¯¥æ¸²æŸ“çš„çŠ¶æ€)ã€‚
è¿™ä¸æ˜¯Reactæ‰€ç‰¹æœ‰çš„ - å¸¸è§„å‡½æ•°ä»¥ç±»ä¼¼çš„æ–¹å¼å·¥ä½œï¼š

``` javascript
function sayHi(person) {
    const name = person.name; setTimeout(() => {
        alert('Hello, ' + name);
    }, 3000); 

}

let someone = {name: 'Dan'}; 
sayHi(someone); 

someone = {name: 'Yuzhi'}; 
sayHi(someone); 

someone = {name: 'Dominic'}; 
sayHi(someone); 
```

åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œå¤–éƒ¨ `someone` å˜é‡è¢«é‡æ–°åˆ†é…å¤šæ¬¡ã€‚(å°±åƒReactä¸­çš„æŸä¸ªåœ°æ–¹ä¸€æ ·ï¼Œå½“å‰ çš„ç»„ä»¶çŠ¶æ€å¯ä»¥æ”¹å˜ã€‚) ä½†æ˜¯ï¼Œåœ¨ `sayHi` ä¸­ï¼Œæœ‰ä¸€ä¸ªæœ¬åœ° `name` å¸¸é‡ä¸ç‰¹å®šè°ƒç”¨ä¸­çš„ `person` ç›¸å…³è”ã€‚ é‚£ä¸ªå¸¸é‡æ˜¯æœ¬åœ°çš„ï¼Œæ‰€ä»¥å®ƒåœ¨è°ƒç”¨ä¹‹é—´æ˜¯ç‹¬ç«‹çš„ï¼å› æ­¤ï¼Œå½“è¶…æ—¶è§¦å‘æ—¶ï¼Œæ¯ä¸ªå¼¹æ¡†éƒ½ä¼šâ€œè®°ä½â€ä»–è‡ªå·±çš„ `name` ã€‚

è¿™è§£é‡Šäº†æˆ‘ä»¬çš„äº‹ä»¶å¤„ç†ç¨‹åºå¦‚ä½•åœ¨å•å‡»æ—¶æ•è· `count` ã€‚å¦‚æœæˆ‘ä»¬åº”ç”¨ç›¸åŒçš„æ›¿æ¢åŸåˆ™ï¼Œæ¯ä¸ªæ¸²æŸ“â€œçœ‹åˆ°â€å®ƒè‡ªå·±çš„ `count` ï¼š

``` javascript
// During first render
function Counter() {

    - const count = 0; // Returned by useState()  // ...

    function handleAlertClick() {
        setTimeout(() => {
        alert('You clicked on: ' + count);
        }, 3000);
    }
    // ...

}

// After a click, our function is called again
    function Counter() {

    - const count = 1; // Returned by useState()  // ...

    function handleAlertClick() {
        setTimeout(() => {
        alert('You clicked on: ' + count);
        }, 3000);
    }
    // ...

}

// After another click, our function is called again
function Counter() {

    - const count = 2; // Returned by useState()  // ...

    function handleAlertClick() {
        setTimeout(() => {
        alert('You clicked on: ' + count);
        }, 3000);
    }
    // ...

}
```

å¦‚æ­¤æœ‰æ•ˆï¼Œæ¯ä¸ªæ¸²æŸ“éƒ½è¿”å›è‡ªå·±â€œç‰ˆæœ¬â€çš„ `handleAlertClick` ã€‚æ¯ä¸ªç‰ˆæœ¬éƒ½â€œè®°ä½â€è‡ªå·±çš„ `count` ï¼š

``` javascript
// During first render
function Counter() {

// ...

function handleAlertClick() {

    setTimeout(() => {

*     alert('You clicked on: ' + 0); 

    }, 3000);

}

// ...

<button onClick={handleAlertClick} /> // The one with 0 inside

// ...

}

// After a click, our function is called again
function Counter() {

// ...

function handleAlertClick() {

    setTimeout(() => {

*     alert('You clicked on: ' + 1); 

    }, 3000);

}

// ...

<button onClick={handleAlertClick} /> // The one with 1 inside

// ...

}

// After another click, our function is called again
function Counter() {

// ...

function handleAlertClick() {

    setTimeout(() => {

*     alert('You clicked on: ' + 2); 

    }, 3000);

}

// ...

<button onClick={handleAlertClick} /> // The one with 2 inside

// ...

}
```

è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨è¿™ä¸ªæ¼”ç¤ºä¸­äº‹ä»¶å¤„ç†ç¨‹åºâ€œå±äºâ€ç‰¹å®šæ¸²æŸ“ï¼Œå½“ä½ ç‚¹å‡»æ—¶ï¼Œå®ƒä¼šç»§ç»­ä½¿ç”¨è¯¥æ¸²æŸ“ä¸­çš„counterçŠ¶æ€ã€‚

**åœ¨ä»»ä½•ç‰¹å®šæ¸²æŸ“ä¸­ï¼Œpropså’ŒçŠ¶æ€æ°¸è¿œä¿æŒä¸å˜**, ä½†æ˜¯ï¼Œå¦‚æœåœ¨æ¸²æŸ“ä¹‹é—´éš”ç¦»äº†propså’ŒçŠ¶æ€ï¼Œé‚£ä¹ˆä½¿ç”¨å®ƒä»¬çš„ä»»ä½•å€¼(åŒ…æ‹¬äº‹ä»¶å¤„ç†ç¨‹åº)éƒ½æ˜¯ç‹¬ç«‹çš„ã€‚å®ƒä»¬ä¹Ÿâ€œå±äºâ€ç‰¹å®šçš„æ¸²æŸ“ã€‚å› æ­¤ï¼Œå³ä½¿äº‹ä»¶å¤„ç†ç¨‹åºä¸­çš„å¼‚æ­¥å‡½æ•°ä¹Ÿä¼šâ€œçœ‹åˆ°â€ç›¸åŒçš„countå€¼ã€‚

æ—æ³¨ï¼šæˆ‘å°†å…·ä½“countå€¼å†…è”åˆ°ä¸Šé¢çš„handleAlertClickå‡½æ•°ä¸­ã€‚è¿™ç§å¿ƒç†æ›¿ä»£æ˜¯å®‰å…¨çš„ï¼Œå› ä¸ºcountä¸å¯èƒ½åœ¨ç‰¹å®šæ¸²æŸ“ä¸­æ”¹å˜ã€‚å®ƒè¢«å£°æ˜ä¸ºconstå¹¶ä¸”æ˜¯ä¸€ä¸ªæ•°å­—ã€‚ä»¥åŒæ ·çš„æ–¹å¼è€ƒè™‘å…¶ä»–å€¼(æ¯”å¦‚å¯¹è±¡)æ˜¯å®‰å…¨çš„ï¼Œä½†å‰ææ˜¯æˆ‘ä»¬åŒæ„é¿å…çŠ¶æ€çš„å˜åŒ–ã€‚ä½¿ç”¨æ–°åˆ›å»ºçš„å¯¹è±¡è°ƒç”¨setSomething(newObj)è€Œä¸æ˜¯å¯¹å…¶è¿›è¡Œä¿®æ”¹ï¼Œå› ä¸ºå±äºä»¥å‰æ¸²æŸ“çš„çŠ¶æ€æ˜¯å®Œæ•´çš„ã€‚

### æ¯ä¸ªæ¸²æŸ“éƒ½æœ‰è‡ªå·±çš„æ•ˆæœ(effects)

    è®©æˆ‘ä»¬å›åˆ°æ–‡æ¡£ä¸­çš„ä¸€ä¸ªä¾‹å­ï¼š

``` javascript
function Counter() {
const [count, setCount] = useState(0);

useEffect(() => {
    document.title = `You clicked ${count} times` ;
});

return (
    <div>
    <p>You clicked {count} times</p>
    <button onClick={() => setCount(count + 1)}>
        Click me
    </button>
    </div>
); 

}
```

**è¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼šæ•ˆæœå¦‚ä½•è¯»å–æœ€æ–°çš„ `count` çŠ¶æ€ï¼Ÿ**
ä¹Ÿè®¸ï¼Œæœ‰æŸç§â€œæ•°æ®ç»‘å®šâ€æˆ–â€œè§‚å¯Ÿâ€ä½¿å¾— `count` æ›´æ–°åœ¨æ•ˆæœå‡½æ•°ä¸­ç”Ÿæ•ˆï¼Ÿä¹Ÿè®¸ `count` æ˜¯ä¸€ä¸ªå¯å˜å˜é‡ï¼ŒReactåœ¨æˆ‘ä»¬çš„ç»„ä»¶ä¸­è®¾ç½®ï¼Œä»¥ä¾¿æˆ‘ä»¬çš„æ•ˆæœæ€»èƒ½çœ‹åˆ°æœ€æ–°å€¼ï¼Ÿ
ä¸è¿‡ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“ `count` åœ¨ç‰¹å®šç»„ä»¶æ¸²æŸ“ä¸­æ˜¯æ’å®š(å¸¸é‡)çš„ã€‚äº‹ä»¶å¤„ç†ç¨‹åºä»æ¸²æŸ“ä¸­"æŸ¥çœ‹"â€å®ƒä»¬â€œæ‰€å±â€çš„ `count` çŠ¶æ€ï¼Œå› ä¸º `count` æ˜¯å®ƒä»¬ä½œç”¨åŸŸä¸­çš„ä¸€ä¸ªå˜é‡ã€‚æ•ˆæœä¹Ÿæ˜¯å¦‚æ­¤ï¼

* `count` å˜é‡ä¸æ˜¯ä»¥æŸç§æ–¹å¼åœ¨â€œä¸å˜â€æ•ˆæœä¸­å‘ç”Ÿå˜åŒ–ã€‚æ•ˆæœå‡½æ•°æœ¬èº«åœ¨æ¯ä¸ªæ¸²æŸ“ä¸Šéƒ½æ˜¯ä¸åŒçš„.

æ¯ä¸ªç‰ˆæœ¬ä»å…¶â€œæ‰€å±â€çš„æ¸²æŸ“ä¸­â€œçœ‹åˆ°â€countå€¼ï¼š

``` javascript
// During first render
function Counter() {

// ...

useEffect(
    // ä¸»è¦æ˜¯çœ‹è¿™é‡Œ
    // Effect function from first render
    () => {
        document.title = `You clicked ${0} times` ; 
    }
); 

// ...

}

// After a click, our function is called again
function Counter() {

// ...

useEffect(
    // ä¸»è¦æ˜¯çœ‹è¿™é‡Œ
    // Effect function from second render
    () => {
        document.title = `You clicked ${1} times` ; 
    }
); 

// ...

}

// After another click, our function is called again
function Counter() {

// ...

useEffect(
    // ä¸»è¦æ˜¯çœ‹è¿™é‡Œ
    // Effect function from third render
    () => {
        document.title = `You clicked ${2} times` ; 
    }
); 
// ..

}
```

Reactä¼šè®°ä½ä½ æä¾›çš„æ•ˆæœå‡½æ•°ï¼Œåˆ·æ–°å¯¹DOMçš„æ›´æ”¹å¹¶è®©æµè§ˆå™¨ç»˜åˆ¶åˆ°å±å¹•åè¿è¡Œè¯¥å‡½æ•°ã€‚

å› æ­¤ï¼Œå³ä½¿æˆ‘ä»¬åœ¨è¿™é‡Œè°ˆåˆ°å•ä¸€æ¦‚å¿µçš„æ•ˆæœ(ç¤ºä¾‹ä¸­çš„æ›´æ–°æ–‡æ¡£æ ‡é¢˜( `document.title=''` ))ï¼Œå®ƒä¹Ÿä¼šåœ¨æ¯ä¸ªæ¸²æŸ“ä¸Šç”¨ä¸åŒçš„å‡½æ•° è¡¨ç¤º â€” å¹¶ä¸”æ¯ä¸ªæ•ˆæœå‡½æ•°ä»å®ƒæ‰€å±çš„ç‰¹å®šæ¸²æŸ“ä¸­â€œçœ‹åˆ°â€propså’ŒçŠ¶æ€ã€‚

**ä»æ¦‚å¿µä¸Šè®²ï¼Œä½ å¯ä»¥æƒ³è±¡æ•ˆæœæ˜¯ æ¸²æŸ“ç»“æœçš„ä¸€éƒ¨åˆ† ã€‚**
ä¸¥æ ¼åœ°è¯´ï¼Œå®ƒä»¬ä¸æ˜¯(ä¸ºäº†å…è®¸Hookç»„åˆè€Œæ²¡æœ‰ç¬¨æ‹™çš„è¯­æ³•æˆ–è¿è¡Œæ—¶å¼€é”€)ã€‚ä½†æ˜¯åœ¨æˆ‘ä»¬æ„å»ºçš„å¿ƒç†æ¨¡å‹ä¸­ï¼Œæ•ˆæœå‡½æ•°å±äºç‰¹å®šçš„æ¸²æŸ“ï¼Œå°±åƒäº‹ä»¶å¤„ç†ç¨‹åºä¸€æ ·ã€‚

-----------------
ä¸ºäº†ç¡®ä¿æˆ‘ä»¬æœ‰ä¸€ä¸ªæ‰å®çš„ç†è§£ï¼Œè®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹æˆ‘ä»¬çš„ç¬¬ä¸€æ¬¡æ¸²æŸ“ï¼š

* React: ç»™æˆ‘ä¸€ä¸ªå½“çŠ¶æ€ä¸º0æ—¶UIã€‚
* ä½ çš„ç»„ä»¶:
    - è¿™æ˜¯æ¸²æŸ“ç»“æœï¼š `<p>You clicked 0 times</p>` ã€‚
    - è¿˜è®°å¾—åœ¨å®Œæˆåè¿è¡Œæ­¤æ•ˆæœï¼š `() => { document.title = 'You * clicked 0 times' }ã€‚`
* React: å½“ç„¶ã€‚æ›´æ–°UIã€‚å˜¿æµè§ˆå™¨ï¼Œæˆ‘æ­£åœ¨å‘DOMæ·»åŠ ä¸€äº›ä¸œè¥¿ã€‚
* Browser: å¾ˆé…·ï¼Œæˆ‘æŠŠå®ƒç”»åˆ°äº†å±å¹•ä¸Šã€‚
* React: å¥½çš„ï¼Œç°åœ¨æˆ‘è¦è¿è¡Œä½ ç»™æˆ‘çš„æ•ˆæœäº†ã€‚
    - è¿è¡Œ `() => { document.title = 'You clicked 0 times' }`
----------------
ç°åœ¨è®©æˆ‘ä»¬å›é¡¾ç‚¹å‡»åå‘ç”Ÿçš„äº‹æƒ…ï¼š

* ä½ çš„ç»„ä»¶: å˜¿Reactï¼ŒæŠŠæˆ‘çš„çŠ¶æ€è®¾ç½®ä¸º1ã€‚
* React: ç»™æˆ‘çŠ¶æ€ä¸º1æ—¶çš„UIã€‚
* ä½ çš„ç»„ä»¶:
    - è¿™æ˜¯æ¸²æŸ“ç»“æœï¼š `<p>You clicked 1 times</p>ã€‚`
    - è¿˜è®°å¾—åœ¨å®Œæˆåè¿è¡Œæ­¤æ•ˆæœï¼š `() => { document.title = 'You * clicked 1 times' }` ã€‚
* React: å½“ç„¶ã€‚æ›´æ–°UIã€‚å˜¿æµè§ˆå™¨ï¼Œæˆ‘æ”¹å˜äº†DOMã€‚
* Browser: å¾ˆé…·ï¼Œæˆ‘æŠŠä½ çš„æ›´æ”¹ç”»åˆ°äº†å±å¹•ä¸Šã€‚
* React: å¥½çš„ï¼Œç°åœ¨æˆ‘å°†è¿è¡Œå±äºæˆ‘åˆšåˆšåšçš„æ¸²æŸ“çš„æ•ˆæœã€‚
    - è¿è¡Œ `() => { document.title = 'You clicked 1 times' }ã€‚`

### æ¯ä¸ªæ¸²æŸ“éƒ½æœ‰å®ƒè‡ªå·±....... ä¸€åˆ‡

**æˆ‘ä»¬ç°åœ¨çŸ¥é“åœ¨æ¯æ¬¡æ¸²æŸ“ä¹‹åè¿è¡Œçš„æ•ˆæœåœ¨æ¦‚å¿µä¸Šæ˜¯ç»„ä»¶è¾“å‡ºçš„ä¸€éƒ¨åˆ†ï¼Œå¹¶ä¸”â€œçœ‹åˆ°â€æ¥è‡ªè¯¥ç‰¹å®šæ¸²æŸ“çš„propså’ŒçŠ¶æ€ã€‚**
æˆ‘ä»¬æ¥è¯•è¯•å§ã€‚è€ƒè™‘ä»¥ä¸‹ä»£ç ï¼š

``` javascript
function Counter() {
const [count, setCount] = useState(0);

// æ‰‹åŠ¨é«˜äº®
useEffect(() => {

    setTimeout(() => {

    console.log( `You clicked ${count} times` ); 
    }, 3000);
}); 

return (
    <div>
    <p>You clicked {count} times</p>
    <button onClick={() => setCount(count + 1)}>
        Click me
    </button>
    </div>
); 

}
```

å¦‚æœæˆ‘ç¨å¾®ç‚¹å‡»å‡ æ¬¡ï¼Œé‚£ä¹ˆlogä¼šæ˜¯ä»€ä¹ˆæ ·å­ï¼Ÿ
ä½ å¯èƒ½è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œæœ€ç»ˆç»“æœæ˜¯ä¸ç›´è§‚çš„ã€‚ä¸æ˜¯è¿™æ ·çš„ï¼æˆ‘ä»¬å°†çœ‹åˆ°ä¸€ç³»åˆ—æ—¥å¿— - æ¯ä¸ªæ—¥å¿—å±äºç‰¹å®šçš„æ¸²æŸ“ï¼Œå› æ­¤å…·æœ‰è‡ªå·±çš„countå€¼ã€‚

![image1](/assets/useEffectImg/1-1.webp "image1")

ä½ å¯èƒ½ä¼šæƒ³ï¼šâ€œå½“ç„¶ï¼Œè¿™å°±æ˜¯å®ƒçš„å·¥ä½œåŸç†ï¼ä¸ç„¶å®ƒè¿˜èƒ½æ€æ ·å·¥ä½œï¼Ÿâ€œ
å¥½å§ï¼Œè¿™ä¸æ˜¯ `this.state` åœ¨ç±»ä¸Šçš„è¿ä½œæ–¹å¼ã€‚å¾ˆå®¹æ˜“é”™è¯¯åœ°è®¤ä¸ºè¿™ä¸ªç±»çš„å®ç°æ˜¯ç­‰ä»·çš„:

``` javascript
componentDidUpdate() {
setTimeout(() => {

    console.log( `You clicked ${this.state.count} times` );

}, 3000); 

}
```

ä½†æ˜¯ï¼Œ `this.state.count` å§‹ç»ˆæŒ‡å‘æœ€æ–°è®¡æ•°è€Œä¸æ˜¯å±äºç‰¹å®šæ¸²æŸ“çš„è®¡æ•°ã€‚æ‰€ä»¥ä½ ä¼šçœ‹åˆ°æ¯æ¬¡è®°å½• `5` ï¼š

![image2](/assets/useEffectImg/1-2.webp "image2")

æˆ‘è®¤ä¸ºå…·æœ‰è®½åˆºæ„å‘³çš„æ˜¯ï¼ŒHookä¸¥é‡ä¾èµ–äº**JavaScripté—­åŒ…**ï¼Œç„¶è€Œæ­£æ˜¯ç±»å®ç°é­å—äº†å…¸å‹çš„è¶…æ—¶é”™è¯¯å€¼çš„æ··æ·†ï¼Œè€Œè¿™ç§æ··æ·†é€šå¸¸ä¸é—­åŒ…ç›¸å…³ã€‚è¿™æ˜¯å› ä¸ºæœ¬ä¾‹ä¸­æ··æ·†çš„å®é™…æ¥æºæ˜¯çªå˜ `ï¼ˆreactä½¿ç±»ä¸­çš„this.stateå‘ç”Ÿçªå˜ï¼Œä»¥æŒ‡å‘æœ€æ–°çŠ¶æ€ï¼‰` ï¼Œè€Œä¸æ˜¯é—­åŒ…æœ¬èº«ã€‚

å½“ä½ ç›¸å…³çš„å€¼æ°¸è¿œä¸å˜æ—¶ï¼Œé—­åŒ…æ˜¯éå¸¸æ£’çš„ã€‚è¿™ä½¿å¾—å®ƒä»¬æ˜“äºæ€è€ƒï¼Œå› ä¸ºä½ å®è´¨ä¸Šæ˜¯æŒ‡å‘å¸¸é‡ã€‚ æ­£å¦‚æˆ‘ä»¬æ‰€è®¨è®ºçš„ï¼Œpropså’ŒçŠ¶æ€æ°¸è¿œä¸ä¼šåœ¨ç‰¹å®šæ¸²æŸ“ä¸­å‘ç”Ÿå˜åŒ–ã€‚é¡ºä¾¿è¯´ä¸€å¥ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨**é—­åŒ…**ä¿®å¤ç±»ç‰ˆæœ¬ä¸­çš„é—®é¢˜ã€‚

### é€†åŠ¿è€Œè¡Œ(é€†æµè€Œä¸Š)(Swimming Against the Tide)

åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæˆ‘ä»¬æ˜ç¡®åœ°ç§°ä¹‹ä¸ºï¼šç»„ä»¶æ¸²æŸ“ä¸­çš„**æ¯ä¸ª**å‡½æ•°(åŒ…æ‹¬äº‹ä»¶å¤„ç†ç¨‹åºã€æ•ˆæœã€è¶…æ—¶æˆ–å…¶ä¸­çš„APIè°ƒç”¨)éƒ½ä¼šæ•è·å®šä¹‰å®ƒçš„æ¸²æŸ“è°ƒç”¨çš„propså’ŒçŠ¶æ€ã€‚
æ‰€ä»¥è¿™ä¸¤ä¸ªä¾‹å­æ˜¯ç­‰ä»·çš„ï¼š

``` javascript
function Example(props) {

    useEffect(() => {
        setTimeout(() => {

    -     console.log(props.counter); }, 1000); 

    }); 

// ...

}

function Example(props) {

* const counter = props.counter; 

    useEffect(() => {
        setTimeout(() => {

    -     console.log(counter); }, 1000); 

    }); 

// ...

}
```

æ— è®ºä½ æ˜¯å¦åœ¨ç»„ä»¶å†…éƒ¨ä»propsæˆ–çŠ¶æ€ä¸­"æå‰"è¯»å–éƒ½æ— å…³ç´§è¦ã€‚ ä»–ä»¬ä¸ä¼šæ”¹å˜ï¼**åœ¨å•ä¸ªæ¸²æŸ“çš„ä½œç”¨åŸŸå†…ï¼Œpropså’ŒçŠ¶æ€ä¿æŒä¸å˜**ã€‚ï¼ˆè§£æ„propsä½¿è¿™æ›´åŠ æ˜æ˜¾ã€‚ï¼‰
å½“ç„¶ï¼Œæœ‰æ—¶ä½ å¸Œæœ›åœ¨æ•ˆæœä¸­å®šä¹‰çš„æŸäº›å›è°ƒä¸­è¯»å–æœ€æ–°è€Œéæ•è·çš„å€¼ã€‚æœ€ç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨refsï¼Œå¦‚æœ¬æ–‡æœ€åä¸€èŠ‚æ‰€è¿°ã€‚

æ³¨æ„ï¼Œå½“ä½ æƒ³ä» è¿‡å» æ¸²æŸ“çš„å‡½æ•°ä¸­è¯»å–**æœªæ¥**çš„propsæˆ–çŠ¶æ€æ—¶ï¼Œä½ æ˜¯åœ¨é€†æ½®æµè€Œä¸Šã€‚è¿™å¹¶æ²¡æœ‰é”™(åœ¨æŸäº›æƒ…å†µä¸‹æ˜¯å¿…è¦çš„)ï¼Œä½†æ‰“ç ´è¿™ç§æ¨¡å¼å¯èƒ½çœ‹èµ·æ¥ä¸é‚£ä¹ˆâ€œå¹²å‡€â€ã€‚è¿™æ˜¯ä¸€ä¸ªæœ‰æ„çš„ç»“æœï¼Œå› ä¸ºå®ƒæœ‰åŠ©äºçªå‡ºå“ªäº›ä»£ç æ˜¯è„†å¼±çš„ï¼Œå¹¶ä¸”ä¾èµ–äºæ—¶é—´è€Œæ”¹å˜ã€‚åœ¨ç±»ä¸Šï¼Œå‘ç”Ÿè¿™ç§æƒ…å†µæ—¶ä¸å¤ªæ˜æ˜¾ã€‚

è¿™æ˜¯æˆ‘ä»¬çš„è®¡æ•°å™¨ç¤ºä¾‹çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œå®ƒå¤åˆ¶äº†ç±»çš„è¡Œä¸ºï¼š

``` javascript
function Example() {
const [count, setCount] = useState(0);
const latestCount = useRef(count);

    useEffect(() => {
        // Set the mutable latest value
        latestCount.current = count; 
        setTimeout(() => {
        // Read the mutable latest value
        console.log( `You clicked ${latestCount.current} times` ); 
        }, 3000); 
    }); 

// ...

}
```

![image3](/assets/useEffectImg/1-3.webp "è®¡æ•°å™¨-è¯»å–æœ€æ–°")

åœ¨Reactä¸­æ”¹å˜ä¸€äº›ä¸œè¥¿ä¼¼ä¹å¾ˆå¤æ€ªã€‚ä½†æ˜¯ï¼Œè¿™æ­£æ˜¯Reactæœ¬èº«åœ¨ç±»ä¸­é‡æ–°åˆ†é… `this.state` çš„æ–¹å¼ã€‚ä¸æ•è·çš„propså’Œstateä¸åŒï¼Œä½ æ— æ³•ä¿è¯è¯»å– `latestCount.current` ä¼šåœ¨ä»»ä½•ç‰¹å®šå›è°ƒä¸­ä¸ºä½ æä¾›ç›¸åŒçš„å€¼ã€‚æ ¹æ®å®šä¹‰ï¼Œä½ å¯ä»¥éšæ—¶æ”¹å˜å®ƒã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå®ƒä¸æ˜¯é»˜è®¤å€¼ï¼Œä½ å¿…é¡»é€‰æ‹©å®ƒã€‚

### é‚£ä¹ˆæ¸…ç†å‘¢?

æ­£å¦‚æ–‡æ¡£æ‰€è§£é‡Šçš„é‚£æ ·ï¼ŒæŸäº›effectå¯èƒ½ä¼šæœ‰ä¸€ä¸ªæ¸…ç†é˜¶æ®µã€‚æœ¬è´¨ä¸Šï¼Œå®ƒçš„ç›®çš„æ˜¯â€œæ’¤æ¶ˆâ€è®¢é˜…ç­‰æƒ…å†µçš„æ•ˆæœã€‚

è€ƒè™‘ä»¥ä¸‹ä»£ç ï¼š

``` javascript
useEffect(() => {
    ChatAPI.subscribeToFriendStatus(props.id, handleStatusChange);
    return () => {
        ChatAPI.unsubscribeFromFriendStatus(props.id, handleStatusChange);
    };
});
```

å‡è®¾propsåœ¨ç¬¬ä¸€ä¸ªæ¸²æŸ“æ—¶ä¸º{idï¼š10}ï¼Œåœ¨ç¬¬äºŒä¸ªæ¸²æŸ“ä¸Šä¸º{idï¼š20}ã€‚ä½  å¯èƒ½ è®¤ä¸ºä¼šå‘ç”Ÿè¿™æ ·çš„äº‹æƒ…:

* Reactæ¸…é™¤ `{idï¼š10}` çš„æ•ˆæœã€‚
* Reactä¸º `{idï¼š20}` æ¸²æŸ“UIã€‚
* Reactè¿è¡Œ `{idï¼š20}` çš„æ•ˆæœã€‚

(æƒ…å†µå¹¶éå¦‚æ­¤ã€‚)
ä½¿ç”¨è¿™ä¸ªå¿ƒç†æ¨¡å‹ï¼Œä½ å¯èƒ½è®¤ä¸ºæ¸…ç†â€œçœ‹åˆ°â€äº†æ—§çš„propsï¼Œå› ä¸ºå®ƒåœ¨æˆ‘ä»¬é‡æ–°æ¸²æŸ“ä¹‹å‰è¿è¡Œï¼Œç„¶åæ–°çš„æ•ˆæœâ€œçœ‹åˆ°â€äº†æ–°propsï¼Œå› ä¸ºå®ƒåœ¨é‡æ–°æ¸²æŸ“ä¹‹åè¿è¡Œã€‚è¿™æ˜¯ç›´æ¥ä»ç±»ç”Ÿå‘½å‘¨æœŸä¸­æå–çš„å¿ƒæ™ºæ¨¡å‹ï¼Œ**è¿™é‡Œå¹¶ä¸å‡†ç¡®** ã€‚è®©æˆ‘ä»¬çœ‹çœ‹è¿™æ˜¯ä¸ºä»€ä¹ˆã€‚

Reactä»…åœ¨è®©æµè§ˆå™¨ç»˜åˆ¶åè¿è¡Œæ•ˆæœã€‚è¿™ä½¿ä½ çš„åº”ç”¨ç¨‹åºæ›´å¿«ï¼Œå› ä¸ºå¤§å¤šæ•°æ•ˆæœä¸éœ€è¦é˜»æ­¢å±å¹•æ›´æ–°ã€‚æ•ˆæœæ¸…ç†ä¹Ÿä¼šå»¶è¿Ÿã€‚ä½¿ç”¨æ–°propsé‡æ–°æ¸²æŸ“åï¼Œå‰ä¸€ä¸ªæ•ˆæœä¼šè¢«æ¸…é™¤ï¼š

* Reactä¸º `{idï¼š20}` æ¸²æŸ“UIã€‚
* æµè§ˆå™¨ç»˜åˆ¶ç”»é¢ã€‚æˆ‘ä»¬åœ¨å±å¹•ä¸Šçœ‹åˆ°äº† `{idï¼š20}` çš„ç”¨æˆ·ç•Œé¢ã€‚
* Reactæ¸…é™¤ `{idï¼š10}` çš„æ•ˆæœã€‚
* Reactè¿è¡Œ `{idï¼š20}` çš„æ•ˆæœã€‚

ä½ å¯èƒ½æƒ³çŸ¥é“ï¼šä½†æ˜¯å¦‚æœåœ¨propså˜ä¸º `{idï¼š20}` ä¹‹åè¿è¡Œï¼Œé‚£ä¹ˆå‰ä¸€æ•ˆæœçš„æ¸…ç†å¦‚ä½•ä»èƒ½â€œçœ‹åˆ°â€æ—§çš„ `{idï¼š10} props` ï¼Ÿ

* å¼•ç”¨ä¸Šä¸€èŠ‚ï¼š

> ç»„ä»¶æ¸²æŸ“ä¸­çš„**æ¯ä¸ª**å‡½æ•°(åŒ…æ‹¬äº‹ä»¶å¤„ç†ç¨‹åºã€æ•ˆæœã€è¶…æ—¶æˆ–å…¶ä¸­çš„APIè°ƒç”¨)éƒ½ä¼šæ•è·å®šä¹‰å®ƒçš„æ¸²æŸ“è°ƒç”¨çš„propså’ŒçŠ¶æ€ã€‚

ç°åœ¨ç­”æ¡ˆå¾ˆæ˜ç¡®ï¼ä¸ç®¡è¿™æ„å‘³ç€ä»€ä¹ˆï¼Œæ•ˆæœæ¸…ç†ä¸ä¼šè¯»å–â€œæœ€æ–°â€çš„propsã€‚å®ƒè¯»å–å±äºå®ƒå®šä¹‰çš„æ¸²æŸ“çš„props:

``` javascript
// First render, props are {id: 10}
function Example() {
// ...
useEffect(
    // Effect from first render
    () => {
    ChatAPI.subscribeToFriendStatus(10, handleStatusChange);
    // Cleanup for effect from first render
    // å˜¿ï¼Œä½ çš„å…³æ³¨ç‚¹æ”¾åœ¨è¿™é‡Œ(æ‰‹åŠ¨é«˜äº®)
    return () => {
        ChatAPI.unsubscribeFromFriendStatus(10, handleStatusChange);
    };
    }
);
// ...
}

// Next render, props are {id: 20}
function Example() {
// ...
useEffect(
    // Effect from second render
    () => {
    ChatAPI.subscribeToFriendStatus(20, handleStatusChange);
    // Cleanup for effect from second render
    return () => {
        ChatAPI.unsubscribeFromFriendStatus(20, handleStatusChange);
    };
    }
);
// ...
}
```
ä½†æ˜¯é™¤äº†`{idï¼š10}`ä¹‹å¤–ï¼Œæ²¡æœ‰ä»»ä½•ä¸œè¥¿å¯ä»¥ä½¿ç¬¬ä¸€ä¸ªæ¸²æŸ“æ•ˆæœçš„æ¸…ç†â€œçœ‹åˆ°â€propsã€‚

è¿™å°±æ˜¯è®©Reactåœ¨ç»˜åˆ¶åç«‹å³å¤„ç†æ•ˆæœçš„åŸå› â€”â€”é»˜è®¤æƒ…å†µä¸‹è®©ä½ çš„åº”ç”¨ç¨‹åºè¿è¡Œå¾—æ›´å¿«ã€‚å¦‚æœæˆ‘ä»¬çš„ä»£ç éœ€è¦å®ƒä»¬ï¼Œæ—§çš„propsä»ç„¶å­˜åœ¨ã€‚

### åŒæ­¥ï¼Œè€Œä¸æ˜¯ç”Ÿå‘½å‘¨æœŸ

>å…³äºReactï¼Œæˆ‘æœ€å–œæ¬¢çš„ä¸€ç‚¹æ˜¯å®ƒç»Ÿä¸€äº†å¯¹åˆå§‹æ¸²æŸ“ç»“æœå’Œæ›´æ–°çš„æè¿°ã€‚è¿™ä¼šä½¿ä½ çš„ç¨‹åºé™ä½ç†µ

å‡è®¾æˆ‘çš„ç»„ä»¶æ˜¯è¿™æ ·çš„ï¼š
``` js
function Greeting({ name }) {
  return (
    <h1 className="Greeting">
      Hello, {name}
    </h1>
  );
}
```
å¦‚æœæˆ‘æ¸²æŸ“`<Greeting name ="Dan"/>`å¹¶ä¸”åé¢åŠ ä¸Š`<Greeting name ="Yuzhi"/>`ï¼Œæˆ–è€…æˆ‘åªæ¸²æŸ“`<Greeting name ="Yuzhi"/>`ï¼Œéƒ½æ— å…³ç´§è¦ã€‚æœ€åï¼Œæˆ‘ä»¬å°†åœ¨ä¸¤ç§æƒ…å†µä¸‹çœ‹åˆ°`â€œHello, Yuzhiâ€`ã€‚

äººä»¬å¸¸è¯´:**â€œé‡è¦çš„æ˜¯è¿‡ç¨‹ï¼Œè€Œä¸æ˜¯ç›®çš„åœ°ã€‚â€**è€Œå¯¹äºReactï¼Œæƒ…å†µæ­£å¥½ç›¸åã€‚**é‡è¦çš„æ˜¯ç›®çš„åœ°ï¼Œè€Œä¸æ˜¯æ—…ç¨‹ã€‚** è¿™å°±æ˜¯jQueryä»£ç ä¸­çš„`$.addClass`å’Œ`$.removeClass`è°ƒç”¨ä¹‹é—´(æˆ‘ä»¬çš„â€œæ—…ç¨‹â€)çš„åŒºåˆ«ï¼Œå¹¶æŒ‡å®šäº†åœ¨Reactä»£ç ä¸­CSSç±»åº”è¯¥æ˜¯ ä»€ä¹ˆ(æˆ‘ä»¬çš„â€œç›®çš„åœ°â€)ã€‚

**Reactæ ¹æ®æˆ‘ä»¬å½“å‰çš„propså’ŒçŠ¶æ€åŒæ­¥DOMã€‚** æ¸²æŸ“æ—¶â€œmountâ€æˆ–â€œupdateâ€ä¹‹é—´æ²¡æœ‰åŒºåˆ«

ä½ åº”è¯¥ä»¥ç±»ä¼¼çš„æ–¹å¼æ€è€ƒæ•ˆæœã€‚`useEffect`å…è®¸ä½ æ ¹æ®æˆ‘ä»¬çš„propså’ŒçŠ¶æ€åŒæ­¥Reactæ ‘ä¹‹å¤–çš„ä¸œè¥¿ã€‚
```js
function Greeting({ name }) {
  useEffect(() => {
    document.title = 'Hello, ' + name;
  });
  return (
    <h1 className="Greeting">
      Hello, {name}
    </h1>
  );
}
```
è¿™ä¸ç†Ÿæ‚‰çš„ `mount/update/unmount` å¿ƒç†æ¨¡å‹ç•¥æœ‰ä¸åŒã€‚å°†å…¶å†…åœ¨åŒ–æ˜¯éå¸¸é‡è¦çš„ã€‚**å¦‚æœä½ è¯•å›¾ç¼–å†™ä¸€ä¸ªæ ¹æ®ç»„ä»¶æ˜¯å¦ç¬¬ä¸€æ¬¡æ¸²æŸ“è€Œè¡¨ç°ä¸åŒçš„æ•ˆæœï¼Œé‚£ä¹ˆä½ å°±æ˜¯åœ¨é€†æµè€Œä¸Š!**å¦‚æœæˆ‘ä»¬çš„ç»“æœå–å†³äºâ€œæ—…ç¨‹â€è€Œä¸æ˜¯â€œç›®çš„åœ°â€ï¼Œæˆ‘ä»¬å°±æ— æ³•åŒæ­¥ã€‚

æ— è®ºæˆ‘ä»¬æ˜¯ä½¿ç”¨props Aï¼ŒBå’ŒCæ¸²æŸ“ï¼Œè¿˜æ˜¯ä½¿ç”¨Cç«‹å³æ¸²æŸ“ï¼Œéƒ½æ— å…³ç´§è¦ã€‚è™½ç„¶å¯èƒ½ä¼šæœ‰ä¸€äº›æš‚æ—¶çš„å·®å¼‚(ä¾‹å¦‚ï¼Œåœ¨è·å–æ•°æ®æ—¶)ï¼Œä½†æœ€ç»ˆçš„ç»“æœåº”è¯¥æ˜¯ç›¸åŒçš„ã€‚

å½“ç„¶ï¼Œåœ¨æ¯ä¸ªæ¸²æŸ“ä¸Šè¿è¡Œæ‰€æœ‰æ•ˆæœå¯èƒ½å¹¶ä¸æ˜¯å¾ˆé«˜æ•ˆã€‚(åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè¿™ä¼šå¯¼è‡´æ— é™å¾ªç¯ã€‚)

é‚£æˆ‘ä»¬æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ

### æ•™Reactå»Diffä½ çš„Effects
>æˆ‘ä»¬å·²ç»ä»DOMæœ¬èº«å¸å–äº†æ•™è®­ã€‚Reactåªæ›´æ–°DOMä¸­å®é™…å‘ç”Ÿæ›´æ”¹çš„éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯åœ¨æ¯æ¬¡é‡æ–°æ¸²æŸ“æ—¶éƒ½ä¿®æ”¹å®ƒã€‚

- å½“ä½ æ›´æ–°
```js
<h1 className="Greeting">
  Hello, Dan
</h1>
```
- åˆ°
```js
<h1 className="Greeting">
  Hello, Yuzhi
</h1>
```
- Reactçœ‹åˆ°ä¸¤ä¸ªå¯¹è±¡
```js
const oldProps = {className: 'Greeting', children: 'Hello, Dan'};
const newProps = {className: 'Greeting', children: 'Hello, Yuzhi'};
```
å®ƒæ£€æŸ¥å®ƒä»¬çš„æ¯ä¸ªpropsï¼Œå¹¶ç¡®å®šå­å…ƒç´ å·²ç»æ›´æ”¹ï¼Œéœ€è¦DOMæ›´æ–°ï¼Œä½†classNameæ²¡æœ‰ã€‚æ‰€ä»¥å®ƒå¯ä»¥è¿™æ ·åš:
```js
domNode.innerText = 'Hello, Yuzhi';
// No need to touch domNode.className
```
>æˆ‘ä»¬å¯ä»¥ç”¨æ•ˆæœåšè¿™æ ·çš„äº‹å—ï¼Ÿå¦‚æœä¸éœ€è¦åº”ç”¨æ•ˆæœï¼Œæœ€å¥½é¿å…é‡æ–°è¿è¡Œå®ƒä»¬ã€‚
ä¾‹å¦‚ï¼Œç”±äºçŠ¶æ€æ›´æ”¹ï¼Œæˆ‘ä»¬çš„ç»„ä»¶å¯èƒ½ä¼šé‡æ–°æ¸²æŸ“ï¼š
``` js
function Greeting({ name }) {
  const [counter, setCounter] = useState(0);

  useEffect(() => {
    document.title = 'Hello, ' + name;
  });

  return (
    <h1 className="Greeting">
      Hello, {name}
      {/* ä½ çš„å…³æ³¨ç‚¹åœ¨è¿™é‡Œ */}
      {/* åŸæ–‡æ­¤å¤„æ˜¯count, å®åˆ™ä¸ºcounter */}
      <button onClick={() => setCounter(count + 1)}>
        Increment
      </button>
    </h1>
  );
}
```
ä½†æ˜¯æˆ‘ä»¬çš„æ•ˆæœä¸ä½¿ç”¨`counter`çŠ¶æ€ã€‚æˆ‘ä»¬çš„æ•ˆæœå°†`document.titleä¸name prop`åŒæ­¥ï¼Œä½†`name prop`æ˜¯ç›¸åŒçš„ã€‚ åœ¨æ¯æ¬¡è®¡æ•°å™¨æ›´æ”¹æ—¶é‡æ–°åˆ†é…`document.title`ä¼¼ä¹å¹¶ä¸ç†æƒ³ã€‚

å¥½å§ï¼Œé‚£ä¹ˆReactä¼šä¸ä¼šåªæ˜¯...å·®å¼‚æ•ˆæœ`(diff effects)`?
```js
let oldEffect = () => { document.title = 'Hello, Dan'; };
let newEffect = () => { document.title = 'Hello, Dan'; };
// Can React see these functions do the same thing?
```
å¹¶ä¸æ˜¯çš„ã€‚Reactæ— æ³•åœ¨ä¸è°ƒç”¨è¯¥å‡½æ•°çš„æƒ…å†µä¸‹çŒœæµ‹è¯¥å‡½æ•°çš„åŠŸèƒ½ã€‚(æºä»£ç å®é™…ä¸Šå¹¶ä¸åŒ…å«ç‰¹å®šçš„å€¼ï¼Œå®ƒåªæ˜¯åœ¨`name prop`ä¸Šç»“æŸã€‚)

è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå¦‚æœä½ æƒ³é¿å…ä¸å¿…è¦åœ°é‡æ–°è¿è¡Œæ•ˆæœï¼Œä½ å¯ä»¥ä¸º**useEffectæä¾›ä¸€ä¸ªä¾èµ–æ•°ç»„ï¼ˆä¹Ÿç§°ä¸ºâ€œdepsâ€ï¼‰å‚æ•°**ï¼š
```js
seEffect(() => {
  document.title = 'Hello, ' + name;
}, [name]); // Our deps
```
>å°±åƒæˆ‘ä»¬å‘Šè¯‰Reactä¸€æ ·ï¼šâ€œå˜¿ï¼Œæˆ‘çŸ¥é“ä½ çœ‹ä¸åˆ°è¿™ä¸ªå‡½æ•°å†…éƒ¨ï¼Œä½†æˆ‘ä¿è¯å®ƒåªä½¿ç”¨nameè€Œä¸æ˜¯æ¸²æŸ“ä½œç”¨åŸŸä¸­çš„ä»»ä½•å…¶ä»–å†…å®¹ã€‚â€

å¦‚æœè¿™ä¸ªæ•ˆæœåœ¨å½“å‰å’Œä¸Šæ¬¡ä¹‹é—´çš„æ¯ä¸ªå€¼éƒ½ç›¸åŒï¼Œåˆ™æ— æ³•åŒæ­¥ï¼Œå› æ­¤Reactå¯ä»¥è·³è¿‡æ•ˆæœï¼š
```js
const oldEffect = () => { document.title = 'Hello, Dan'; };
const oldDeps = ['Dan'];

const newEffect = () => { document.title = 'Hello, Dan'; };
const newDeps = ['Dan'];
```
å¦‚æœç”šè‡³ä¾èµ–é¡¹æ•°ç»„ä¸­çš„ä¸€ä¸ªå€¼åœ¨æ¸²æŸ“ä¹‹é—´æ˜¯ä¸åŒçš„ï¼Œæˆ‘ä»¬çŸ¥é“è¿è¡Œæ•ˆæœä¸èƒ½è¢«è·³è¿‡ã€‚åŒæ­¥æ‰€æœ‰çš„ä¸œè¥¿ï¼

## é—®é¢˜æ€»ç»“

### ğŸ¤”é—®é¢˜ä¸€ï¼š å¦‚ä½•ä½¿ç”¨useEffectæ›¿ä»£componentDidMount?

è™½ç„¶å¯ä»¥ç”¨ `useEffect(fn, [])` , ä½†å®ƒå¹¶ä¸æ˜¯å®Œå…¨ç­‰ä»·çš„ã€‚ä¸ `componentDidMount` ä¸åŒï¼Œå®ƒå°†*æ•è·* `(capture)props` å’ŒçŠ¶æ€ã€‚æ‰€ä»¥å³ä½¿åœ¨å›è°ƒä¸­ï¼Œä½ ä¹Ÿä¼šçœ‹åˆ°æœ€åˆçš„ `props` å’ŒçŠ¶æ€ã€‚å¦‚æœä½ æƒ³çœ‹åˆ°**æœ€æ–°**çš„ä¸œè¥¿ï¼Œä½ å¯ä»¥æŠŠå®ƒå†™åˆ° `ref` ã€‚ä½†æ˜¯é€šå¸¸æœ‰ä¸€ç§æ›´ç®€å•çš„æ–¹æ³•æ¥æ„é€ ä»£ç ï¼Œè¿™æ ·ä½ å°±ä¸å¿…è¿™æ ·åšäº†ã€‚è¯·è®°ä½ï¼Œæ•ˆæœ `(effect)` çš„å¿ƒç†æ¨¡å‹ä¸ `componentDidMount` å’Œå…¶ä»–ç”Ÿå‘½å‘¨æœŸä¸åŒï¼Œè¯•å›¾æ‰¾åˆ°å®ƒä»¬çš„ç¡®åˆ‡å¯¹ç­‰ç‰©å¯èƒ½ä¼šè®©ä½ æ„Ÿåˆ°å›°æƒ‘ï¼Œè€Œä¸æ˜¯æœ‰æ‰€å¸®åŠ©ã€‚ä¸ºäº†æé«˜æ•ˆç‡ï¼Œä½ éœ€è¦"æ€è€ƒæ•ˆæœ", ä»–ä»¬çš„å¿ƒæ™ºæ¨¡å‹æ›´æ¥è¿‘äºå®ç°åŒæ­¥ï¼Œè€Œä¸æ˜¯å“åº”ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ã€‚

### ğŸ¤”é—®é¢˜äºŒï¼š å¦‚ä½•åœ¨useEffectä¸­æ­£ç¡®è·å–æ•°æ®? ä»€ä¹ˆæ˜¯[]ï¼Ÿ

[]è¡¨ç¤ºè¯¥æ•ˆæœä¸ä½¿ç”¨å‚ä¸ `React` æ•°æ®æµçš„ä»»ä½•å€¼ï¼Œå› æ­¤å¯ä»¥å®‰å…¨åœ°åº”ç”¨ä¸€æ¬¡ã€‚å½“å®é™…ä½¿ç”¨è¯¥å€¼æ—¶ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ªå¸¸è§çš„ `bug` æºã€‚ä½ éœ€è¦å­¦ä¹ ä¸€äº›ç­–ç•¥(ä¸»è¦æ˜¯ `useReducer` å’Œ `useCallback` ), è¿™äº›ç­–ç•¥å¯ä»¥æ¶ˆé™¤å¯¹ä¾èµ–é¡¹çš„éœ€è¦ï¼Œè€Œä¸æ˜¯é”™è¯¯çš„å¿½ç•¥å®ƒã€‚

### ğŸ¤”é—®é¢˜ä¸‰ï¼šä¸ºä»€ä¹ˆæœ‰æ—¶ä¼šå¾—åˆ°ä¸€ä¸ªæ— é™é‡å¤è·å–å¾ªç¯?

å¦‚æœåœ¨æ²¡æœ‰ç¬¬äºŒä¸ªä¾èµ–é¡¹å‚æ•°çš„æƒ…å†µä¸‹åœ¨ä¸€ä¸ªæ•ˆæœä¸­æ‰§è¡Œæ•°æ®è·å–ï¼Œåˆ™å¯èƒ½ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚æ²¡æœ‰å®ƒï¼Œæ•ˆæœä¼šåœ¨æ¯æ¬¡æ¸²æŸ“åè¿è¡Œ - è®¾ç½®çŠ¶æ€å°†å†æ¬¡è§¦å‘æ•ˆæœã€‚å¦‚æœæŒ‡å®šçš„è¿™ä¸ªå€¼å§‹ç»ˆåœ¨ä¾èµ–å…³ç³»æ•°ç»„ä¸­æ”¹å˜ï¼Œä¹Ÿå¯èƒ½å‘ç”Ÿæ— é™å¾ªç¯ã€‚ä½ å¯ä»¥é€šè¿‡ä¸€ä¸ªä¸€ä¸ªåœ°æŠŠå®ƒä»¬ç§»é™¤æ¥è¾¨åˆ«æ˜¯å“ªä¸ªã€‚ä½†æ˜¯ï¼Œåˆ é™¤ä½ ä½¿ç”¨çš„ä¾èµ–é¡¹ï¼ˆæˆ–ç›²ç›®æŒ‡å®š[]ï¼‰é€šå¸¸æ˜¯é”™è¯¯çš„ä¿®å¤ã€‚ç›¸åï¼Œä»æºå¤´è§£å†³é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œå‡½æ•°å¯èƒ½ä¼šå¯¼è‡´è¿™ä¸ªé—®é¢˜ï¼Œå°†å®ƒä»¬æ”¾åœ¨æ•ˆæœä¸­ã€å°†å®ƒä»¬æå‡ºæ¥æˆ–ä½¿ç”¨ `useCallback` åŒ…è£…å®ƒä»¬ä¼šæœ‰æ‰€å¸®åŠ©ã€‚ä¸ºé¿å…é‡æ–°åˆ›å»ºå¯¹è±¡ï¼Œ `useMemo` å¯ç”¨äºç±»ä¼¼ç›®çš„ã€‚

### ğŸ¤”é—®é¢˜å››ï¼šä¸ºä»€ä¹ˆæˆ‘æœ‰æ—¶ä¼šåœ¨æ•ˆæœä¸­è·å¾—æ—§çš„çŠ¶æ€æˆ–propså€¼ï¼Ÿ

æ•ˆæœæ€»æ˜¯ä»å®šä¹‰çš„æ¸²æŸ“ä¸­â€œçœ‹åˆ°â€ `props` å’ŒçŠ¶æ€ã€‚è¿™æœ‰åŠ©äºé˜²æ­¢é”™è¯¯ï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½ä¼šä»¤äººè®¨åŒã€‚å¯¹äºè¿™äº›æƒ…å†µï¼Œä½ å¯ä»¥æ˜¾å¼åœ°åœ¨å¯å˜ `ref` ä¸­ç»´æŠ¤ä¸€äº›å€¼ã€‚å¦‚æœä½ è®¤ä¸ºä½ ä»æ—§çš„æ¸²æŸ“ä¸­çœ‹åˆ°äº†ä¸€äº› `props` æˆ–çŠ¶æ€ï¼Œä½†å¹¶ä¸æ˜¯ä½ æœŸæœ›çš„ï¼Œé‚£ä¹ˆä½ å¯èƒ½é”™è¿‡äº†ä¸€äº›ä¾èµ–é¡¹ã€‚å°è¯•ä½¿ç”¨ `lint` è§„åˆ™æ¥é”»ç‚¼è‡ªå·±å‘ç°å®ƒä»¬ã€‚è¿‡å‡ å¤©ï¼Œå®ƒå°±ä¼šæˆä¸ºä½ çš„ç¬¬äºŒå¤©æ€§ã€‚

>ä¸‹ä¸€ä¸ªç¯‡ç« --[useEffectæŒ‡å—(2)](/hook/useEffect/second "æŒ‡å—(2)")

ä½œè€…ï¼šxiaohesong
é“¾æ¥ï¼šhttps://www.jianshu.com/p/5e3eca65dd49
æ¥æºï¼šç®€ä¹¦
å¤‡æ³¨ï¼šä»¥ä¸Šå†…å®¹å…¨éƒ¨æ¥è‡ªä½œè€…xiaohesongï¼Œæœ¬æ–‡ç« ä¸»è¦ç”¨äºè‡ªå·±æ¢³ç†ç¬”è®°.
