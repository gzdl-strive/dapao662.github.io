---
title: ç¬¬ä¸‰ç«™ï¼šæœåŠ¡ç«¯å“åº”
date: 2021-05-25 16:15:20
tag: performance
toc: true
---

[ğŸ”™ä¸Šä¸€ç«™- å‘é€è¯·æ±‚](/All/performance/journey/request "å‘é€è¯·æ±‚")

æŠŠè¿™ä¸€éƒ¨åˆ†æ”¾è¿›å‰ç«¯æ€§èƒ½ä¼˜åŒ–å¹¶ä¸æ˜¯å¾ˆä¸¥è°¨ï¼š
* å…¶ä¸€ï¼ŒæœåŠ¡ç«¯æœ‰ç€æœåŠ¡ç«¯çš„é€šç”¨æŠ€æœ¯æ‰‹æ®µï¼Œè¿™å—æ·±å…¥å»ç ”ç©¶ï¼Œä¼šæ˜¯ä¸€ä¸ªä¸ä¸€æ ·çš„é¢†åŸŸï¼›
* å…¶äºŒï¼Œæˆ‘ä»¬æ—¢ç„¶åœ¨è®¨è®ºå‰ç«¯æ€§èƒ½ä¼˜åŒ–ï¼Œè¿™éƒ¨åˆ†ä¸»è¦è¿˜æ˜¯æŒ‡NodeJS,ä½†ä¸æ˜¯æ‰€ä»¥ä¸šåŠ¡éƒ½ä½¿ç”¨NodeJS.

æ‰€ä»¥è¿™é‡Œåªä¼šæä¸€äº›å®è·µä¸­ç¢°åˆ°çš„å°ç‚¹ï¼Œè¾…ä»¥ä¸€äº›æ‹“å±•é˜…è¯»ï¼Œå¸Œæœ›èƒ½å¸®åŠ©å¤§å®¶æŠ›ç –å¼•ç‰ï¼Œå¼€æ‹“æ€ç»´ã€‚

## 1ã€ä½¿ç”¨æµè¿›è¡Œå“åº”
ç›®å‰ï¼Œç°ä»£æµè§ˆå™¨éƒ½æ”¯æŒæ ¹æ®æµçš„è¿”å›å½¢å¼æ¥é€æ­¥è¿›è¡Œé¡µé¢å†…å®¹çš„è§£æã€å¤„ç†ã€‚è¿™å°±æ„å‘³ç€ï¼Œå³ä½¿è¯·æ±‚çš„å“åº”æ²¡æœ‰å®Œå…¨ç»“æŸï¼Œæµè§ˆå™¨ä¹Ÿå¯ä»¥ä»æ‰‹é‡Œå·²æœ‰çš„å“åº”ç»“æœä¸­è¿›è¡Œé¡µé¢çš„è§£æä¸æ¸²æŸ“ã€‚

ä¾‹å¦‚ `css-only-chat-node` å°±åˆ©ç”¨äº†è¿™ä¸ªç‰¹ç‚¹æ¥å®ç°æ— åˆ·æ–°ã€æ—  JavaScript çš„é¡µé¢æ›´æ–°ã€‚

## 2ã€ä¸šåŠ¡èšåˆ
`BFF `éå¸¸åˆé€‚åšçš„ä¸€ä»¶äº‹å°±æ˜¯åç«¯æœåŠ¡çš„èšåˆã€‚

å¦‚æœä½ æœ‰ä¸€ä¸ªä¸¤ä¸ªæ¥å£æœåŠ¡ï¼šç¬¬ä¸€ä¸ªæœåŠ¡æ˜¯å…ˆè·å–äº§å“ä¿¡æ¯ï¼Œå†æ ¹æ®äº§å“ä¿¡æ¯ä¸­çš„ä¸Šæ¶æ—¶é—´é€šè¿‡ç¬¬äºŒä¸ªæœåŠ¡è·å–è¯¥æ—¶é—´åçš„äº§å“åˆ—è¡¨ã€‚è¿™ä¸ªä¸šåŠ¡é€»è¾‘å¦‚æœæ”¾åœ¨å‰ç«¯ï¼ˆæµè§ˆå™¨ï¼‰å¤„ç†å°†ä¼šä¸²è¡Œå‘é€ä¸¤ä¸ªè¯·æ±‚ã€‚å‡è®¾æ¯ä¸ªè¯·æ±‚ 200msï¼Œé‚£ä¹ˆå°±éœ€è¦ç­‰å¾… 400msã€‚å¦‚æœå¼•å…¥ NodeJSï¼Œè¿™ä¸€å±‚å¯ä»¥æ”¾åœ¨ NodeJS ä¸­å®ç°ã€‚NodeJS éƒ¨ç½²çš„ä½ç½®ä¸€èˆ¬ç¦»å…¶ä»–åç«¯æœåŠ¡â€œæ›´è¿‘â€ï¼Œä¾‹å¦‚åŒä¸€ä¸ªå±€åŸŸç½‘ã€‚è¿™ç±»æœåŠ¡é—´çš„è¯·æ±‚è€—æ—¶æ˜¾ç„¶æ›´ä½ï¼Œå¯èƒ½åªéœ€è¦ 200(æµè§ˆå™¨) + 30(NodeJS) * 2 = 260msã€‚

æ­¤å¤–ï¼Œå¦‚æœä¸€ä¸ªä¸šåŠ¡éœ€è¦åœ¨å‰ç«¯å¹¶å‘ä¸‰ã€å››ä¸ªè¯·æ±‚æ¥è·å–å®Œæ•´æ•°æ®ï¼Œé‚£ä¹ˆæ”¾åœ¨ NodeJS çš„ BFF å±‚ä¹Ÿæ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚

## 3ã€é¿å…ä»£ç é—®é¢˜
ä»£ç é—®é¢˜å…¶å®å°±éå¸¸ç»†èŠ‚äº†ã€‚ç®€å•åˆ—ä¸¾ä¸€äº›å¸¸è§çš„é—®é¢˜ï¼š

* async await çš„ä¸å½“ä½¿ç”¨å¯¼è‡´å¹¶è¡Œè¯·æ±‚è¢«ä¸²è¡ŒåŒ–äº†ï¼›
* é¢‘ç¹åœ° JSON.parse å’Œ JSON.stringify å¤§å¯¹è±¡ï¼›
* æ­£åˆ™è¡¨è¾¾å¼çš„ç¾éš¾æ€§å›æº¯ï¼›
* é—­åŒ…å¯¼è‡´çš„å†…å­˜æ³„æ¼ï¼›
* CPU å¯†é›†å‹ä»»åŠ¡å¯¼è‡´äº‹ä»¶å¾ªç¯ delay ä¸¥é‡ï¼›
* æœªæ•è·çš„å¼‚å¸¸å¯¼è‡´è¿›ç¨‹é¢‘ç¹é€€å‡ºï¼Œå®ˆæŠ¤è¿›ç¨‹ï¼ˆpm2/supervisorï¼‰åˆå°†è¿›ç¨‹é‡å¯ï¼Œè¿™ç§é¢‘ç¹çš„å¯åœä¹Ÿä¼šæ¯”è¾ƒæ¶ˆè€—èµ„æºï¼›
* â€¦â€¦
ã€Œå‰ç«¯æ€§èƒ½ä¼˜åŒ–ä¹‹æ—…ã€åœ¨è¿™ä¸€é˜¶æ®µåªèƒ½èœ»èœ“ç‚¹æ°´äº†ã€‚NodeJS ä½œä¸º BFF è¿˜æ˜¯æ¯”è¾ƒå¸¸è§çš„ï¼Œæ‰€ä»¥åœ¨æ—…é€”ä¸­ä¹Ÿæäº†ä¸€ä¸‹ã€‚ä¸‹é¢æˆ‘ä»¬å°±è¦é‡æ–°å›åˆ°å‰ç«¯é¢†åŸŸäº†ï¼Œå‡†å¤‡å¥½äº†ä¹ˆ


>[ä¸‹ä¸€ç«™ï¼šé¡µé¢è§£æä¸å¤„ç†ğŸ”œ](/All/performance/journey/pageAnalysis "é¡µé¢è§£æä¸å¤„ç†")