---
title: React15å’ŒReact16ç”Ÿå‘½å‘¨æœŸå¯¹æ¯”ï¼Œåˆè¯†Fiber
date: 2020-11-17 19:58:10
tag: react
toc: true
---

**Reactçš„ç”Ÿå‘½å‘¨æœŸå°±æ˜¯ç»„ä»¶ä»åˆå§‹åŒ–åˆ°å¸è½½åˆ°å…¨è¿‡ç¨‹ï¼Œå¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªé˜¶æ®µ**
1. åˆå§‹åŒ–é˜¶æ®µ
2. æ›´æ–°é˜¶æ®µ
3. å¸è½½é˜¶æ®µ
>ä¸ºäº†æ›´åŠ äº†è§£Reactç”Ÿå‘½å‘¨æœŸçš„å‘å±•èƒŒæ™¯ï¼Œæˆ‘ä»¬å…ˆä»React15æ¥çœ‹ä¸€ä¸‹Reactçš„ç”Ÿå‘½å‘¨æœŸ

## React15çš„ç”Ÿå‘½å‘¨æœŸ
![1](/assets/reactImg/3-1.png "react15ç”Ÿå‘½å‘¨æœŸ")

### åˆå§‹åŒ–é˜¶æ®µ
åœ¨åˆå§‹åŒ–é˜¶æ®µï¼Œç”Ÿå‘½å‘¨æœŸä¼šæŒ‰ç…§å¦‚ä¸‹æµç¨‹æ‰§è¡Œï¼Œè¿™ä¸ªè¿‡ç¨‹åœ¨ç»„ä»¶çš„ä¸€ç”Ÿä¸­åªä¼šæ‰§è¡Œä¸€æ¬¡
![2](/assets/reactImg/3-2.png "react15åˆå§‹åŒ–")
**constructor**: å¸¸ç”¨æ¥åˆå§‹åŒ–`State`
**componentWillMount**: é€šè¿‡renderå‡½æ•°ç”Ÿæˆè™šæ‹ŸDOMä¹‹å‰è§¦å‘ï¼Œé¸¡è‚‹
**render**: é€šè¿‡Diffç®—æ³•ï¼Œç”Ÿæˆæ–°çš„è™šæ‹ŸDOM
**componentDidMount**:ç»„ä»¶æ¸²æŸ“å®Œæˆä¹‹åè§¦å‘ï¼Œè¿™é‡Œå¯ä»¥æ“ä½œçœŸå®DOM,ä¹Ÿå¯ä»¥è¿›è¡Œå¼‚æ­¥æ•°æ®è¯·æ±‚

### æ›´æ–°é˜¶æ®µ
**æ›´æ–°æœ‰ä¸¤ç§æƒ…å†µï¼š**
1. çˆ¶ç»„ä»¶æ›´æ–°è§¦å‘çš„æ›´æ–°
2. è‡ªèº«Stateæ”¹å˜è§¦å‘çš„æ›´æ–°
![3](/assets/reactImg/3-3.png "æ›´æ–°é˜¶æ®µ")
**æ³¨ï¼š`componentWillReceiveProps()`æ˜¯ç”±çˆ¶ç»„ä»¶çš„æ›´æ–°è§¦å‘çš„ï¼Œè·Ÿ`props`æ˜¯å¦å˜åŒ–æ— å…³**
>è¿™é‡Œé‡ç‚¹äº†è§£ä¸€ä¸‹`shouldComponentUpdate(nextProps,nextState)`,è¿™æ˜¯Reactæä¾›çš„ä¸€ä¸ªç”¨äºæ€§èƒ½ä¼˜åŒ–çš„ä¸€ä¸ªç‚¹
é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯æ¬¡æ•°æ®æ›´æ–°Reactéƒ½ä¼šå»é¢‘ç¹è°ƒç”¨renderå‡½æ•°ï¼Œè€Œrenderå‡½æ•°æ˜¯ç”¨æ¥ç”Ÿæˆæ–°çš„è™šæ‹ŸDOMçš„ï¼Œè¿™ä¸ªè¿‡ç¨‹æ¯”è¾ƒè€—æ—¶ï¼Œ`shouldComponentUpdate()`æ–¹æ³•åœ¨renderå‡½æ•°ä¹‹å‰æ‰§è¡Œï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ª`boolean`ç±»å‹çš„å€¼ï¼ˆé»˜è®¤ä¸ºtrueï¼‰ï¼Œå½“è¿”å›trueå½“æ—¶å€™ï¼Œæ‰å›ç»§ç»­èµ°åç»­çš„æ›´æ–°ç”Ÿå‘½å‘¨æœŸæµç¨‹ï¼Œå¦åˆ™ä¸ä¼šç»§ç»­æ‰§è¡Œ
ä¸¾ä¸ªğŸŒ°
```js
shouldComponentUpdate(nextProps,nextState){
  if(...){
     return true
  }else{
    return false
  }
}
```

### å¸è½½é˜¶æ®µ
ç»„ä»¶å¸è½½æ‰æ—¶å€™ï¼Œä¼šæ‰§è¡Œ`componentWillUnmount()`æ–¹æ³•

### æ€»ç»“
>`React15`ä¸­ç”Ÿå‘½å‘¨æœŸå¯ä»¥åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼Œåˆ†åˆ«æ˜¯**åˆå§‹åŒ–é˜¶æ®µ**ï¼Œ**æ›´æ–°é˜¶æ®µ**ï¼Œ**å¸è½½é˜¶æ®µ**
**åˆå§‹åŒ–é˜¶æ®µ**ï¼š`constructor`, `componentWillMount`, `render`, `componentDidMount`
**æ›´æ–°é˜¶æ®µ**ï¼š `componentWillReceiveProps`, `shouldComponentUpdate`, `componentWillUpdate`, `render`, `componentDidUpdate`
**å¸è½½é˜¶æ®µ**ï¼š `componentWillUnmont`
è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯æ›´æ–°é˜¶æ®µï¼Œ`componentWillReceiveProps`æ˜¯ç”±çˆ¶ç»„ä»¶è§¦å‘çš„æ›´æ–°ï¼Œåªè¦çˆ¶ç»„ä»¶æ›´æ–°ï¼Œå­ç»„ä»¶çš„è¯¥ç”Ÿå‘½å‘¨æœŸå°±ä¼šè¢«æ‰§è¡Œï¼Œè·Ÿ`props`æ— å…³ã€‚åŒæ˜¯ï¼Œ`shouldComponentUpdate`å¯ä»¥ç”¨æ¥åšæ€§èƒ½ä¼˜åŒ–

## React16çš„ç”Ÿå‘½å‘¨æœŸ
å…ˆæ¥å¤§æ¦‚çœ‹ä¸€ä¸‹React16é‡Œé¢çš„ç”Ÿå‘½å‘¨æœŸå›¾
![4](/assets/reactImg/3-4.png "react16ç”Ÿå‘½å‘¨æœŸ")
åœ¨React16çš„ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œå»æ‰äº†æ›¾ç»çš„`componentWillMount`å’Œ`componentWillUpdate`ï¼Œä½¿ç”¨`getDerivedStateFromProps`ä»£æ›¿è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚åŒæ—¶åœ¨æ›´æ–°é˜¶æ®µçš„`render`æ–¹æ³•å’Œ`componentDidUpdate`ä¹‹é—´ï¼Œæ–°å¢äº†ä¸€ä¸ª`getSnapshotBeforeUpdate`æ–¹æ³•ã€‚æ¥ä¸‹æ¥å°±æ¥è¯¦ç»†äº†è§£ä¸€ä¸‹Reactè¿™ä¹ˆåšçš„åŸç†ä»¥åŠè¿™äº›æ–°å¢ç”Ÿå‘½å‘¨æœŸçš„å…·ä½“ä½¿ç”¨
ä¸¾ä¸ªğŸŒ°
**çˆ¶ç»„ä»¶**
```js
import React, { Component } from "react";
import SonComponent from "./test2";

class FatherComponent extends Component {
    constructor(props) {
        super(props);
        this.state = {
            fatherTxt: 'çˆ¶ç»„ä»¶ç”Ÿå‘½å‘¨æœŸæµ‹è¯•',
            sonTxt: "å­ç»„ä»¶æ¥å—çˆ¶ç»„ä»¶çš„å‚æ•°"
        };
        console.log('çˆ¶ç»„ä»¶constructor...');
    }
    static getDerivedStateFromProps() {
        console.log('çˆ¶ç»„ä»¶getDerivedStateFromProps...');
        return null;
    }
    componentDidMount() {
        console.log('çˆ¶ç»„ä»¶componentDidMount...');
    }
    componentDidUpdate() {
        console.log('çˆ¶ç»„ä»¶componentDidUpdate...');
    }
    getSnapshotBeforeUpdate() {
        console.log('çˆ¶ç»„ä»¶getSnapshotBeforeUpdate...');
        return null;
    }
    changeFatherTxt() {
        this.setState({
            fatherTxt: "çˆ¶ç»„ä»¶æ”¹å˜ä¹‹åçš„æ–‡æ¡ˆ"
        });
    }
    changeSonTxt() {
        this.setState({
            sonTxt: "å­ç»„ä»¶æ”¹å˜ä¹‹åçš„æ–‡æ¡ˆ"
        });
    }
    render() {
        console.log('çˆ¶ç»„ä»¶render...');
        return (
            <div>
                <p>çˆ¶ç»„ä»¶æ–‡æ¡ˆ:{this.state.fatherTxt}</p>
                <button onClick={this.changeFatherTxt.bind(this)}>çˆ¶ç»„ä»¶æ”¹å˜State</button>
                <button onClick={this.changeSonTxt.bind(this)}>æ”¹å˜å­ç»„ä»¶State</button>
                <hr/>
                <SonComponent sonTxt={this.state.sonTxt}/>
            </div>
        );
    }
}
export default FatherComponent;
```
**å­ç»„ä»¶**
```js
import React, { Component } from "react";

class SonComponent extends Component {
    constructor(props) {
        super(props);
        this.state = {};
        console.log('å­ç»„ä»¶constructor...');
    }
    static getDerivedStateFromProps() {
        console.log('å­ç»„ä»¶getDerivedStateFromProps...');
        return null;
    }
    componentDidMount() {
        console.log('å­ç»„ä»¶componentDidMount...');
    }
    componentDidUpdate() {
        console.log('å­ç»„ä»¶componentDidUpdate...');
    }
    getSnapshotBeforeUpdate() {
        console.log('å­ç»„ä»¶getSnapshotBeforeUpdate...');
        return null;
    }
    render() {
        console.log('å­ç»„ä»¶render...');
        return (
            <div>
                <p>å­ç»„ä»¶æ–‡æ¡ˆ--{this.props.sonTxt}</p>
            </div>
        )
    }
}

export default SonComponent;
```
**æ‰“å°ç¤ºä¾‹**
![5](/assets/reactImg/3-5.png "æ‰“å°å®ä¾‹")
### åˆå§‹åŒ–é˜¶æ®µï¼ˆæŒ‚è½½ï¼‰
ä¸ºäº†æ¯”è¾ƒReact15å’ŒReact16çš„åŒºåˆ«ï¼Œå…ˆæ¥çœ‹å¦‚ä¸‹ä¸€å¼ å›¾
![6](/assets/reactImg/3-6.png "React15å’ŒReact16çš„åŒºåˆ«")
>å¯ä»¥å¾ˆç›´è§‚çš„å‘ç°ï¼Œæ¯”èµ·`React15`ï¼Œ`React16`çš„ç”Ÿå‘½å‘¨æœŸå»æ‰äº†`componentWillMount`ï¼Œæ–°å¢äº†`getDerivedStateFromProps`ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ`getDerivedStateFromProps`å¹¶ä¸æ˜¯ç”¨æ¥ä»£æ›¿`componentWillMount`æ–¹æ³•çš„ï¼Œå®ƒæ˜¯ç”¨æ¥æ›¿æ¢`componentWillReceiveProps`çš„ã€‚
è‡³äº`componentWillMount`æ–¹æ³•ï¼Œæœ¬èº«å°±å¾ˆé¸¡è‚‹ï¼Œè€Œä¸”ç»å¸¸è¢«ä¸æ°å½“çš„ä½¿ç”¨ï¼Œæ‰€ä»¥åœ¨React16ä¸­è¢«å»æ‰äº†

æ¥ä¸‹æ¥å°±æ¥é‡ç‚¹çœ‹ä¸€ä¸‹`getDerivedStateFromProps`è¿™ä¸ªæ–¹æ³•ï¼Œä»åå­—ä¸Šå°±å¯ä»¥çœ‹å‡ºï¼Œè¯¥æ–¹æ³•æ˜¯ç”¨æ¥**æ ¹æ®çˆ¶ç»„ä»¶ä¼ é€’è¿‡æ¥çš„propsæ¥æ›´æ–°è‡ªèº«çš„state**çš„ä¸€ä¸ªæ–¹æ³•ï¼Œä½¿ç”¨è¿‡ç¨‹ä¸­æœ‰ä»¥ä¸‹å‡ ç‚¹éœ€è¦æ³¨æ„
1. `getDerivedStateFromProps`æ˜¯ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œå£°æ˜çš„ä½¿ç”¨`static`
```js
static getDerivedStateFromProps(props,state){
  return newState
}
```
2. `getDerivedStateFromProps`æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯çˆ¶ç»„ä»¶ä¼ é€’è¿‡æ¥çš„`props`å’Œè‡ªèº«çš„`state`
ç¤ºä¾‹åŒ1
3. `getDerivedStateFromProps`å¿…é¡»è¿”å›ä¸€ä¸ª**å¯¹è±¡æ ¼å¼çš„è¿”å›å€¼**ï¼Œå¦åˆ™æ§åˆ¶å°ä¼šè¢«è­¦å‘Š
è¯¥è¿”å›å€¼ä¼šè¢«ç”¨æ¥æ›´æ–°ç°æœ‰`state`(å¹¶ä¸ä¼šè¦†ç›–åŸæœ‰`State`ï¼Œåªåšå®šå‘æ›´æ–°ï¼Œå¦‚æœåŸæ¥`State`ä¸­æ²¡æœ‰è¯¥å±æ€§ï¼Œåˆ™æ–°å¢)ï¼Œå¦‚æœæ²¡æœ‰éœ€è¦æ›´æ–°çš„æ—¶å€™ï¼Œè¯·è®°å¾—è¿”å›ä¸€ä¸ª`null`
![7](/assets/reactImg/3-7.png "getDerivedStateFromProps")
### æ›´æ–°é˜¶æ®µï¼ˆç»„ä»¶æ›´æ–°ï¼‰
![8](/assets/reactImg/3-8.png "æ›´æ–°é˜¶æ®µ")
åœ¨åˆå§‹åŒ–é˜¶æ®µï¼Œæˆ‘ä»¬é‡ç‚¹äº†è§£äº†ä¸€ä¸‹`getDerivedStateFromprops`æ–¹æ³•ï¼Œä¸Šé¢æˆ‘ä»¬ä¹Ÿè¯´è¿‡ï¼Œ`getDerivedStateFromProps`æ˜¯ç”¨æ¥æ›¿ä»£`componentWillReveiveprops`æ–¹æ³•çš„ã€‚æ ¹æ®Reactå®˜æ–¹çš„æè¿°
>ä¸ `componentDidUpdate` ä¸€èµ·ï¼Œè¿™ä¸ªæ–°çš„ç”Ÿå‘½å‘¨æœŸæ¶µç›–è¿‡æ—¶`componentWillReceiveProps` çš„æ‰€æœ‰ç”¨ä¾‹ã€‚
**But Why?**
è¿™é‡Œå¼•ç”¨æ‹‰é’©æ•™è‚²ä¿®è¨€è€å¸ˆåœ¨æ·±å…¥æµ…å‡ºæå®šReactä¸­çš„è®²è§£ï¼Œæˆ‘è§‰å¾—ä»–è¿™ä¸ªè®²è§£é€šä¿—æ˜“æ‡‚ï¼Œå®åœ¨æ— æ³•è¶…è¶Š
>è¯´å› `getDerivedStateFromProps` è¿™ä¸ª APIï¼Œå®ƒç›¸å¯¹äºæ—©æœŸçš„ `componentWillReceiveProps` æ¥è¯´ï¼Œæ­£æ˜¯åšäº†â€œåˆç†çš„å‡æ³•â€ã€‚è€Œåšè¿™ä¸ªå‡æ³•çš„å†³å¿ƒä¹‹å¼ºçƒˆï¼Œä» `getDerivedStateFromProps` ç›´æ¥è¢«å®šä¹‰ä¸º `static` æ–¹æ³•è¿™ä»¶äº‹ä¸Šå°±å¯è§ä¸€æ–‘â€”â€” `static` æ–¹æ³•å†…éƒ¨æ‹¿ä¸åˆ°ç»„ä»¶å®ä¾‹çš„ `this`ï¼Œè¿™å°±å¯¼è‡´ä½ æ— æ³•åœ¨ `getDerivedStateFromProps` é‡Œé¢åšä»»ä½•ç±»ä¼¼äº `this.fetch()`ã€ä¸åˆç†çš„ `this.setState`ï¼ˆä¼šå¯¼è‡´æ­»å¾ªç¯çš„é‚£ç§ï¼‰è¿™ç±»å¯èƒ½ä¼šäº§ç”Ÿå‰¯ä½œç”¨çš„æ“ä½œã€‚
å› æ­¤ï¼Œ`getDerivedStateFromProps` ç”Ÿå‘½å‘¨æœŸæ›¿ä»£ `componentWillReceiveProps` çš„èƒŒåï¼Œæ˜¯ `React 16` åœ¨å¼ºåˆ¶æ¨è¡Œâ€œåªç”¨ `getDerivedStateFromProps` æ¥å®Œæˆ `props` åˆ° `state` çš„æ˜ å°„â€è¿™ä¸€æœ€ä½³å®è·µã€‚æ„åœ¨ç¡®ä¿ç”Ÿå‘½å‘¨æœŸå‡½æ•°çš„è¡Œä¸ºæ›´åŠ å¯æ§å¯é¢„æµ‹ï¼Œä»æ ¹æºä¸Šå¸®å¼€å‘è€…é¿å…ä¸åˆç†çš„ç¼–ç¨‹æ–¹å¼ï¼Œé¿å…ç”Ÿå‘½å‘¨æœŸçš„æ»¥ç”¨ï¼›åŒæ—¶ï¼Œä¹Ÿæ˜¯åœ¨ä¸ºæ–°çš„ `Fiber` æ¶æ„é“ºè·¯ã€‚

é™¤äº†`getDerivedState`æ–¹æ³•ï¼Œåœ¨æ›´æ–°é˜¶æ®µï¼ŒReact16ä¸­ä¹Ÿå»æ‰äº†`componentWillUpdate`æ–¹æ³•ï¼Œæ–°å¢äº†`getSnapshotBrforeUpdate`æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•åœ¨`render`æ–¹æ³•ä¹‹åï¼Œ`componentDidUpdate`ä¹‹å‰è¢«æ‰§è¡Œï¼Œå³çœŸå®DOMæ›´æ–°ä¹‹å‰ï¼ˆè·å–æ›´æ–°å‰çš„çœŸå®DOMå’Œæ›´æ–°å‰åçš„`State&props`ä¿¡æ¯ï¼‰ã€‚è¯¥æ–¹æ³•éœ€è¦ä¸€ä¸ªè¿”å›å€¼ï¼Œä½œä¸º`componentDidUpdate`çš„ç¬¬ä¸‰ä¸ªå‚æ•°ã€‚ç”±äºè¯¥æ–¹æ³•ä½¿ç”¨åœºæ™¯å¾ˆå°‘ï¼Œè¿™é‡Œä¸åšè¯¦ç»†ä»‹ç»
### å¸è½½é˜¶æ®µ
åŒReact15
### æ€»ç»“
ç›¸å¯¹äº`React15`ï¼Œ`React16`çš„ç”Ÿå‘½å‘¨æœŸä¸­å»æ‰äº†`componentWillMout`å’Œ`componentWillUpdate`æ–¹æ³•ï¼Œå¹¶ä¸”ä½¿ç”¨`getDerivedStateFromProps`æ–¹æ³•æ›¿ä»£äº†ä¹‹å‰çš„`componentWillReceiveprops`ï¼Œä½¿å¾—Reactçš„ç”Ÿå‘½å‘¨æœŸæ›´çº¯ç²¹ï¼Œåªç”¨æ¥åšä¸“é—¨çš„äº‹æƒ…ï¼Œé¿å…å¤§é‡ä¸šåŠ¡é€»è¾‘ä»£ç åµŒå…¥ç”Ÿå‘½å‘¨æœŸï¼ŒåŒæ—¶ä¹Ÿæ˜¯åœ¨ä¸º`Fiber`æ¶æ„é“ºè·¯

## åˆè¯†Fiberæ¶æ„
**ä»€ä¹ˆæ˜¯Fiberï¼ŸFiberå¯¹Reactçš„æ”¹å˜ï¼Ÿ**
`Fiber`æ˜¯`React16`å¯¹`React`æ ¸å¿ƒç®—æ³•çš„ä¸€æ¬¡é‡å†™
`FIber`ä¼šä½¿åŸæœ¬åŒæ­¥æ¸²æŸ“è¿‡ç¨‹å˜æˆå¼‚æ­¥
### Reactå†å²ç®—æ³•æœ‰ä»€ä¹ˆé£é™©ï¼Ÿ
>åœ¨React16ä¹‹å‰ï¼Œæ¯ä¸€æ¬¡ç»„ä»¶çš„æ›´æ–°éƒ½ä¼šè§¦å‘Reactå»æ„å»ºä¸€é¢—æ–°çš„è™šæ‹ŸDOMæ ‘ï¼Œé€šè¿‡ä¸ä¸Šä¸€æ¬¡è™šæ‹ŸDOMæ ‘çš„diffç®—æ³•å¯¹æ¯”ï¼Œå®ç°å¯¹DOMçš„å®šå‘æ›´æ–°ã€‚è¿™ä¸ªè¿‡ç¨‹æ˜¯ä¸€ä¸ªé€’å½’çš„è¿‡ç¨‹ï¼Œè°ƒç”¨æ ˆéå¸¸æ·±ï¼Œåªæœ‰æœ€åº•å±‚çš„è¿”å›äº†ï¼Œæ•´ä¸ªæ¸²æŸ“è¿‡ç¨‹æ‰å›å¼€å§‹é€å±‚è¿”å›ã€‚è€Œè¿™ä¸ªæ¼«é•¿ä¸”ä¸å¯è¢«æ‰“æ–­çš„è¿‡ç¨‹ï¼Œå°†ä¼šç»™ç”¨æˆ·çš„ä½“éªŒå¸¦æ¥å·¨å¤§çš„é£é™©ï¼šåŒæ­¥æ¸²æŸ“ä¸€æ—¦å¼€å§‹ï¼Œä¾¿ä¼šç‰¢ç‰¢æŠ“ä½çº¿ç¨‹ï¼Œç›´åˆ°é€’å½’å®Œæˆï¼Œè¿™ä¸ªå›½æ’æµè§ˆå™¨ä¸ä¼šå¤„ç†ä»»ä½•æ¸²æŸ“ä¹‹å¤–çš„äº‹æƒ…ï¼Œä¼šè¿›å…¥ä¸€ç§æ— æ³•å¤„ç†ç”¨æˆ·äº¤äº’çš„çŠ¶æ€ï¼Œé¡µé¢å¯èƒ½ä¼šå¡æ­»ã€‚
### Fiberæ˜¯æ€æ ·å¤„ç†æ¸²æŸ“çš„ï¼Ÿ
>Fiber ä¼šå°†ä¸€ä¸ªå¤§çš„æ›´æ–°ä»»åŠ¡æ‹†è§£ä¸ºè®¸å¤šä¸ªå°ä»»åŠ¡ã€‚æ¯å½“æ‰§è¡Œå®Œä¸€ä¸ªå°ä»»åŠ¡æ—¶ï¼Œæ¸²æŸ“çº¿ç¨‹éƒ½ä¼šæŠŠä¸»çº¿ç¨‹äº¤å›å»ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰ä¼˜å…ˆçº§æ›´é«˜çš„å·¥ä½œè¦å¤„ç†ï¼Œç¡®ä¿ä¸ä¼šå‡ºç°å…¶ä»–ä»»åŠ¡è¢«â€œé¥¿æ­»â€çš„æƒ…å†µï¼Œè¿›è€Œé¿å…åŒæ­¥æ¸²æŸ“å¸¦æ¥çš„å¡é¡¿ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ¸²æŸ“çº¿ç¨‹ä¸å†â€œä¸€å»ä¸å›å¤´â€ï¼Œè€Œæ˜¯å¯ä»¥è¢«æ‰“æ–­çš„ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„â€œå¼‚æ­¥æ¸²æŸ“â€
### è¯´å›ç”Ÿå‘½å‘¨æœŸ
åœ¨æœ€å¼€å§‹ç»™å‡ºç”Ÿå‘½å‘¨æœŸå›¾çš„æ—¶å€™ï¼Œç»†å¿ƒçš„åŒå­¦ä¼šå‘ç°ï¼Œåœ¨ä¸‹é¢è¿™å¼ å›¾çš„å·¦è¾¹ï¼ŒReactåˆå°†ç”Ÿå‘½å‘¨æœŸåˆ’åˆ†äº†å¦‚ä¸‹ä¸‰ä¸ªé˜¶æ®µ
* renderï¼šçº¯å‡€ä¸”æ²¡æœ‰å‰¯ä½œç”¨ï¼Œå¯èƒ½ä¼šè¢«æš‚åœæˆ–è€…ç»ˆæ­¢ï¼Œé‡æ–°å¯åŠ¨
* Pre-commité˜¶æ®µï¼šå¯ä»¥è¯»å–DOM
* commité˜¶æ®µï¼šå¯ä»¥ä½¿ç”¨DOMï¼Œè¿è¡Œå‰¯ä½œç”¨ï¼Œå®‰æ’æ›´æ–°
![9](/assets/reactImg/3-4.png "react16ç”Ÿå‘½å‘¨æœŸ")
ä¸ºä»€ä¹ˆä¼šè¿™æ ·åˆ†å‘¢ï¼Ÿ
>æ€»çš„æ¥è¯´ï¼Œ`render` é˜¶æ®µåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å…è®¸è¢«æ‰“æ–­ï¼Œè€Œ `commit` é˜¶æ®µåˆ™æ€»æ˜¯åŒæ­¥æ‰§è¡Œçš„ã€‚
ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡å‘¢ï¼Ÿç®€å•æ¥è¯´ï¼Œç”±äº `render` é˜¶æ®µçš„æ“ä½œå¯¹ç”¨æˆ·æ¥è¯´å…¶å®æ˜¯â€œä¸å¯è§â€çš„ï¼Œæ‰€ä»¥å°±ç®—æ‰“æ–­å†é‡å¯ï¼Œå¯¹ç”¨æˆ·æ¥è¯´ä¹Ÿæ˜¯é›¶æ„ŸçŸ¥ã€‚è€Œ `commit` é˜¶æ®µçš„æ“ä½œåˆ™æ¶‰åŠçœŸå® `DOM` çš„æ¸²æŸ“ï¼Œå†ç‹‚çš„æ¡†æ¶ä¹Ÿä¸æ•¢åœ¨ç”¨æˆ·çœ¼çš®å­åº•ä¸‹èƒ¡ä¹±æ›´æ”¹è§†å›¾ï¼Œæ‰€ä»¥è¿™ä¸ªè¿‡ç¨‹å¿…é¡»ç”¨åŒæ­¥æ¸²æŸ“æ¥æ±‚ç¨³ã€‚
### åºŸé™¤çš„ç”Ÿå‘½å‘¨æœŸè·ŸFiberä¹‹é—´çš„è”ç³»
>åœ¨ `Fiber` æœºåˆ¶ä¸‹ï¼Œ`render` é˜¶æ®µæ˜¯å…è®¸æš‚åœã€ç»ˆæ­¢å’Œé‡å¯çš„ã€‚å½“ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œåˆ°ä¸€åŠè¢«æ‰“æ–­åï¼Œä¸‹ä¸€æ¬¡æ¸²æŸ“çº¿ç¨‹æŠ¢å›ä¸»åŠ¨æƒæ—¶ï¼Œè¿™ä¸ªä»»åŠ¡è¢«é‡å¯çš„å½¢å¼æ˜¯â€œé‡å¤æ‰§è¡Œä¸€éæ•´ä¸ªä»»åŠ¡â€è€Œéâ€œæ¥ç€ä¸Šæ¬¡æ‰§è¡Œåˆ°çš„é‚£è¡Œä»£ç å¾€ä¸‹èµ°â€ã€‚è¿™å°±å¯¼è‡´ `render` é˜¶æ®µçš„ç”Ÿå‘½å‘¨æœŸéƒ½æ˜¯æœ‰å¯èƒ½è¢«é‡å¤æ‰§è¡Œçš„ã€‚
å¸¦ç€è¿™ä¸ªç»“è®ºï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹ `React 16 `æ‰“ç®—åºŸå¼ƒçš„æ˜¯å“ªäº›ç”Ÿå‘½å‘¨æœŸï¼š
`componentWillMount`ï¼›
`componentWillUpdate`ï¼›
`componentWillReceiveProps`ã€‚
è¿™äº›ç”Ÿå‘½å‘¨æœŸçš„å…±æ€§ï¼Œå°±æ˜¯å®ƒä»¬éƒ½å¤„äº `render` é˜¶æ®µï¼Œéƒ½å¯èƒ½é‡å¤è¢«æ‰§è¡Œï¼Œè€Œä¸”ç”±äºè¿™äº›` API` å¸¸å¹´è¢«æ»¥ç”¨ï¼Œå®ƒä»¬åœ¨é‡å¤æ‰§è¡Œçš„è¿‡ç¨‹ä¸­éƒ½å­˜åœ¨ç€ä¸å¯å°è§‘çš„é£é™©ã€‚



ä½œè€…ï¼šmapengfei47
é“¾æ¥ï¼šhttps://juejin.im/post/6892604247893147656
æ¥æºï¼šæ˜é‡‘
