---
title: 5--8例子
date: 2020-10-31 16:42:30
tag: js
---

### 5、Array.prototype.map()

![img](/assets/jsImg/3.png "img")

```js
Array.prototype.map = function(callback, thisArg) {
    if(this == undefined) {
        throw new TypeError('this is null or not defined');
    }
    if(typeof callback !== 'function') {
        throw new TypeError(callback + 'is not a function');
    }
    const res = [];
    //// 让O成为回调函数的对象传递（强制转换对象）
    const O = Object(this);
    // >>>0 保证len为number，且为正整数
    const len = O.length >>> 0;
    for (let i = 0; i < len; i++) {
        if(i in O) {
            // 调用回调函数并传入新数组
            res[i] = callback.call(thisArg, O[i], i, this);
        }
    }
    return res;
}
```

### 6、Array.prototype.forEach()
>`forEach`跟map类似，唯一不同的是`forEach`是没有返回值的。
```js
Array.prototype.forEach = function (callback, thisArg) {
    if (this == null) {
        throw new TypeError('this is null or not defined');
    }
    if(typeof callback !== 'function') {
        throw new TypeError(callback + 'is not a function');
    }
    //同理
    const O = Object(this);
    const len = O.length >>> 0;
    let k = 0;
    while(k < len) {
        if(k in O) {
            callback.call(thisArg, O[k], k, O)
        }
        k++;
    }
}
```

### 7、Array.prototype.reduce()

```js
Array.prototype.reduce = function(callback, initialValue) {
    if(this == undefined) {
        throw new TypeError('this is null or not defined');
    }
    if(typeof callback !== 'function') {
        throw new TypeError(callback + 'is not a function');
    }
    const O = Object(this);
    const len = O.length >>> 0;
    let accumulator = initialValue;
    let k = 0;
    // 如果第二个参数为undefined的情况下
    // 则数组的第一个有效值作为累加器的初始值
    if(accumulator === undefined) {
        while(k < len && !(k in O)) {
            k++;
        }
        // 如果超出数组界限还没有找到累加器的初始值，则TypeError
        if(k >= len) {
            throw new TypeError('reduce of empty array with no initial value');
        }
        accumulator = O[k++];
    }
    while(k < len) {
        if(k in O) {
            accumulator = callback.call(undefined, accumulator, O[k], k, O);
        }
        k++;
    }
    return accumulator;
}

```


### 8、Function.prototype.apply
>第一个参数是绑定的this，默认为`window`,第二个参数是数组或类数组

```js
//apply的应用--把数组展开传递给之前的方法
//console.log(Math.max.apply(null, arr))
Function.prototype.apply = function(context = window, args) {
    if(typeof this !== 'function') {
        throw new TypeError('Type Error');
    }
    const fn = Symbol('fn');
    //this是函数
    context[fn] = this;
    //把args的数作为函数的参数
    const res = context[fn](...args);
    delete context[fn];
    return res;
}
```